<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"cooperxj.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="记录一些学习笔记、小说、随笔">
<meta property="og:type" content="website">
<meta property="og:title" content="Cooper Notes">
<meta property="og:url" content="http://cooperxj.github.io/page/21/index.html">
<meta property="og:site_name" content="Cooper Notes">
<meta property="og:description" content="记录一些学习笔记、小说、随笔">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Cooper">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://cooperxj.github.io/page/21/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Cooper Notes</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Cooper Notes</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">obey rules</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/MySQL/BLGC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/MySQL/BLGC/" class="post-title-link" itemprop="url">BLGC</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-07 08:43:29" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-27 22:38:45" itemprop="dateModified" datetime="2021-08-27T22:38:45+08:00">2021-08-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/MySQL/BLGC/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/MySQL/BLGC/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="事务是如何提交的？事务提交先写binlog还是redo-log？如何保证这两部分的日志做到顺序一致性？"><a href="#事务是如何提交的？事务提交先写binlog还是redo-log？如何保证这两部分的日志做到顺序一致性？" class="headerlink" title="事务是如何提交的？事务提交先写binlog还是redo log？如何保证这两部分的日志做到顺序一致性？"></a>事务是如何提交的？事务提交先写binlog还是redo log？如何保证这两部分的日志做到顺序一致性？</h3><h4 id="MySQL没有开启Binary-log的情况下？"><a href="#MySQL没有开启Binary-log的情况下？" class="headerlink" title="MySQL没有开启Binary log的情况下？"></a>MySQL没有开启Binary log的情况下？</h4><p>Innodb通过Redo Log和Undo Log可以保证以上两点。为了保证严格的CrashSafe，必须要在每个事务提交的时候，将Redo Log写入硬件存储。这样做会牺牲一些性能，但是可靠性最好。为了平衡两者，InnoDB提供了一个innodb_flush_log_at_trx_commit系统变量，用户可以根据应用的需求自行调整。</p>
<p>通过redo日志将所有已经在存储引擎内部提交的事务应用redo log恢复，所有已经prepare但是没有commit的transactions将会应用undo log做rollback。然后客户端连接时就能看到已经提交的数据存在数据库内，未提交被回滚地数据需要重新执行。</p>
<h4 id="MySQL开启Binary-log的情况下？"><a href="#MySQL开启Binary-log的情况下？" class="headerlink" title="MySQL开启Binary log的情况下？"></a>MySQL开启Binary log的情况下？</h4><p>MySQL为了保证master和slave的数据一致性，就必须保证binlog和InnoDB redo日志的一致性（因为备库通过二进制日志重放主库提交的事务，而主库binlog写入在commit之前，如果写完binlog主库crash，再次启动时会回滚事务。但此时从库已经执行，则会造成主备数据不一致）。所以在开启Binlog后，如何保证binlog和InnoDB redo日志的一致性呢？为此，MySQL引入二阶段提交（two phase commit or 2pc），MySQL内部会自动将普通事务当做一个XA事务（内部分布式事物）来处理：</p>
<ol>
<li><p>准备阶段（Storage Engine（InnoDB） Transaction Prepare Phase）</p>
<p>此时SQL已经成功执行，并生成xid信息及redo和undo的内存日志。然后调用prepare方法完成第一阶段，papare方法实际上什么也没做，将事务状态设为TRX_PREPARED，并将redo log刷磁盘。</p>
</li>
<li><p>提交阶段(Storage Engine（InnoDB）Commit Phase)</p>
<ol>
<li><p>记录协调者日志，即Binlog日志。</p>
<p>如果事务涉及的所有存储引擎的prepare都执行成功，则调用TC_LOG_BINLOG::log_xid方法将SQL语句写到binlog（<font color=red>write()将binary log内存日志数据写入文件系统缓存，fsync()将binary log文件系统缓存日志数据永久写入磁盘</font>）。此时，事务已经铁定要提交了。否则，调用ha_rollback_trans方法回滚事务，而SQL语句实际上也不会写到binlog。</p>
</li>
<li><p>告诉引擎做commit。</p>
<p>最后，调用引擎的commit完成事务的提交。会清除undo信息，刷redo日志，将事务设为TRX_NOT_STARTED状态。</p>
<p><font color=red>记录Binlog是在InnoDB引擎Prepare（即Redo Log写入磁盘）之后，这点至关重要。</font></p>
</li>
</ol>
<p>由上面的二阶段提交流程可以看出，一旦步骤2中的操作完成，就确保了事务的提交，即使在执行步骤3时数据库发送了宕机。此外需要注意的是，每个步骤都需要进行一次fsync操作才能保证上下两层数据的一致性。步骤2的fsync参数由sync_binlog=1控制，步骤3的fsync由参数innodb_flush_log_at_trx_commit=1控制，俗称“双1”，是保证CrashSafe的根本。</p>
</li>
</ol>
<p><strong>原理</strong>：</p>
<p>事务的两阶段提交协议保证了无论在任何情况下，事务要么同时存在于存储引擎和binlog中，要么两个里面都不存在，这就保证了主库与从库之间数据的一致性。如果数据库系统发生崩溃，当数据库系统重新启动时会进行崩溃恢复操作，存储引擎中处于prepare状态的事务会去查询该事务是否也同时存在于binlog中，如果存在就在存储引擎内部提交该事务（因为此时从库可能已经获取了对应的binlog内容），如果binlog中没有该事务，就回滚该事务。例如：当崩溃发生在第一步和第二步之间时，明显处于prepare状态的事务还没来得及写入到binlog中，所以该事务会在存储引擎内部进行回滚，这样该事务在存储引擎和binlog中都不会存在；当崩溃发生在第二步和第三步之间时，处于prepare状态的事务存在于binlog中，那么该事务会在存储引擎内部进行提交，这样该事务就同时存在于存储引擎和binlog中。</p>
<h4 id="为了保障主从复制安全，故障恢复是如何做的？"><a href="#为了保障主从复制安全，故障恢复是如何做的？" class="headerlink" title="为了保障主从复制安全，故障恢复是如何做的？"></a>为了保障主从复制安全，故障恢复是如何做的？</h4><p>开启Binary log的MySQL在crash recovery时：MySQL在prepare阶段会生成xid，然后会在commit阶段写入到binlog中。在进行恢复时事务要提交还是回滚，是由Binlog来决定的。</p>
<p><font color=red>一个事务在prepare阶段中落盘成功，并在MySQL Server层中的binlog也写入成功，那这个事务必定commit成功</font></p>
<h4 id="为什么需要保证二进制日志的写入顺序和InnoDB层事务提交顺序一致性呢？"><a href="#为什么需要保证二进制日志的写入顺序和InnoDB层事务提交顺序一致性呢？" class="headerlink" title="为什么需要保证二进制日志的写入顺序和InnoDB层事务提交顺序一致性呢？"></a>为什么需要保证二进制日志的写入顺序和InnoDB层事务提交顺序一致性呢？</h4><img src="https://img-service.csdnimg.cn/img_convert/2e8f31646e4e70ce2fb70e071d4c4171.png" alt="img" style="zoom:50%;" />

<p>如上图，事务按照T1、T2、T3顺序开始执行，将二进制日志（按照T1、T2、T3顺序）写入日志文件系统缓冲，调用fsync()进行一次group commit将日志文件永久写入磁盘，但是存储引擎提交的顺序为T2、T3、T1(也就是顺序不一致)。当T2、T3提交事务之后，若通过在线物理备份进行数据库恢复来建立复制时，因为在InnoDB存储引擎层会检测事务T3在上下两层都完成了事务提交（他不会去检查T1是否已经提交了），不需要在进行恢复了，此时主备数据不一致（搭建Slave时，change master to的日志偏移量记录T3在事务位置之后）。</p>
<h3 id="BLGC（Binary-Log-Group-Commit）"><a href="#BLGC（Binary-Log-Group-Commit）" class="headerlink" title="BLGC（Binary Log Group Commit）"></a>BLGC（Binary Log Group Commit）</h3><h3 id="组提交后如何保证事务记录到binlog的顺序和-事务提交到存储引擎的一致性呢？"><a href="#组提交后如何保证事务记录到binlog的顺序和-事务提交到存储引擎的一致性呢？" class="headerlink" title="组提交后如何保证事务记录到binlog的顺序和 事务提交到存储引擎的一致性呢？"></a>组提交后如何保证事务记录到binlog的顺序和 事务提交到存储引擎的一致性呢？</h3><p>MySQL 5.6 BLGC技术出现后，在这种情况下，不但MySQL数据库上层二进制日志写入是group commit的，InnoDB存储引擎层也是group commit的。此外还移除了原先的锁prepare_commit_mutex，从而大大提高了数据库的整体性。其事务的提交（commit）过程分成三个阶段，Flush stage、Sync stage、Commit stage。</p>
<p><strong>Binlog组提交的基本思想是，引入队列机制保证Innodb commit顺序与binlog落盘顺序一致</strong>，并将事务分组，组内的binlog刷盘动作交给一个事务进行，实现组提交目的。在MySQL数据库上层进行提交时首先按顺序将其放入一个队列中，队列中的第一个事务称为leader，其他事务称为follow，leader控制着follow的行为。</p>
<p>当一个事务来到一个stage是一个空队列，那么他就是leader，后面来的事务就是follower，leader控制队列中follower的行为。如果<font color=red>leader带着自己的follower去下一个stage</font>，是非空队列，那么leader变成follower。但是follower不会变成leader。</p>
<img src="https://img-service.csdnimg.cn/img_convert/af22285b3cdd1b247a426105c59ff5d2.png" alt="img" style="zoom:50%;" />

<p>从上图可以看出，每个阶段都有一个队列，每个队列有一个mutex保护，约定进入队列第一个线程为leader，其他线程为follower，所有事情交由leader去做，leader做完所有动作后，通知follower刷盘结束。BLGC就是将事务提交分为了3个阶段，FLUSH阶段，SYNC阶段和COMMIT阶段。</p>
<ul>
<li>Flush Stage</li>
</ul>
<p>将每个事务的二进制日志写入内存中。</p>
<ol>
<li><p>持有Lock_log mutex [leader持有，follower等待]。</p>
</li>
<li><p>获取队列中的一组binlog(队列中的所有事务)。</p>
</li>
<li><p>将binlog buffer到I/O cache。</p>
</li>
<li><p>通知dump线程dump binlog。</p>
</li>
</ol>
<ul>
<li>Sync Stage</li>
</ul>
<p>将内存中的二进制日志刷新到磁盘，若队列中有多个事务，那么仅一次fsync操作就完成了二进制日志的写入，这就是BLGC。</p>
<ol>
<li><p>释放Lock_log mutex，持有Lock_sync mutex[leader持有，follower等待]。</p>
</li>
<li><p>将一组binlog 落盘(sync动作，最耗时，假设sync_binlog为1)。</p>
</li>
</ol>
<ul>
<li>Commit Stage</li>
</ul>
<p><strong>leader根据顺序调用存储引擎层事务的提交</strong>，Innodb本身就支持group commit，因此修复了原先由于锁prepare_commit_mutex导致group commit失效的问题。</p>
<ol>
<li><p>释放Lock_sync mutex，持有Lock_commit mutex[leader持有，follower等待]。</p>
</li>
<li><p>遍历队列中的事务，逐一进行innodb commit。</p>
</li>
<li><p>释放Lock_commit mutex。</p>
</li>
<li><p>唤醒队列中等待的线程。</p>
</li>
</ol>
<p>说明：由于有多个队列，每个队列各自有mutex保护，队列之间是顺序的，约定进入队列的一个线程为leader，因此FLUSH阶段的leader可能是SYNC阶段的follower，但是follower永远是follower。</p>
<p>当有一组事务在进行commit阶段时，其他新事物可以进行Flush阶段，从而使group commit不断生效。当然group commit的效果由队列中事务的数量决定，若每次队列中仅有一个事务，那么可能效果和之前差不多，甚至会更差。但当提交的事务越多时，group commit的效果越明显，数据库性能的提升也就越大。</p>
<p>MySQL提供了一个参数binlog_max_flush_queue_time（MySQL 5.7.9版本失效），默认值为0，用来控制MySQL 5.6新增的BLGC（binary log group commit），就是二进制日志组提交中Flush阶段中等待的时间，即使之前的一组事务完成提交，当前一组的事务也不马上进入Sync阶段，而是至少需要等待一段时间，这样做的好处是group commit的事务数量更多，然而这也可能会导致事务的响应时间变慢。该参数默认为0表示不等待，且推荐设置依然为0。除非用户的MySQL数据库系统中有大量的连接（如100个连接），并且不断地在进行事务的写入或更新操作。</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xibuhaohao/p/10899586.html">参考</a></p>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/MySQL/MySQL%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/MySQL/MySQL%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" class="post-title-link" itemprop="url">MySQL主要配置文件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-07 08:43:29" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-12 09:56:12" itemprop="dateModified" datetime="2021-07-12T09:56:12+08:00">2021-07-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/MySQL/MySQL%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/MySQL/MySQL%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>MySQL主要配置文件</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210217221010.png" alt="MySQL主要配置文件"></p>
<h3 id="mysql配置文件的读取顺序"><a href="#mysql配置文件的读取顺序" class="headerlink" title="mysql配置文件的读取顺序"></a>mysql配置文件的读取顺序</h3><p><code>mysql --help|grep my.cnf</code></p>
<p>以读取到显示出来的最后一个文件为准</p>
<p>一般来说在linux上的读取顺序为</p>
<p><code>/etc/my.cnf /etc/mysql/my.cnf /usr/etc/my.cnf ~/.my.cnf</code></p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> For advice on how to change settings please see</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> http://dev.mysql.com/doc/refman/5.6/en/server-configuration-defaults.html</span></span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># Remove leading # and set to the amount of RAM for the most important data</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cache <span class="keyword">in</span> MySQL. Start at 70% of total RAM <span class="keyword">for</span> dedicated server, <span class="keyword">else</span> 10%.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> innodb_buffer_pool_size = 128M</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># Remove leading # to turn on a very important data integrity option: logging</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> changes to the binary <span class="built_in">log</span> between backups.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> log_bin</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># Remove leading # to set options mainly useful for reporting servers.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The server defaults are faster <span class="keyword">for</span> transactions and fast SELECTs.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Adjust sizes as needed, experiment to find the optimal values.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> join_buffer_size = 128M</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sort_buffer_size = 2M</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> read_rnd_buffer_size = 2M</span></span><br><span class="line">character_set_server=utf8</span><br><span class="line">character_set_client=utf8</span><br><span class="line">datadir=/var/lib/mysql  # 存放数据库文件的地址</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line">symbolic-links=0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Recommended <span class="keyword">in</span> standard MySQL setup</span></span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES </span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error=/var/log/mysqld.log</span><br><span class="line">pid-file=/var/run/mysqld/mysqld.pid</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8C%83%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8C%83%E5%BC%8F/" class="post-title-link" itemprop="url">数据库范式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-07 08:43:29" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-13 08:27:06" itemprop="dateModified" datetime="2021-02-13T08:27:06+08:00">2021-02-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8C%83%E5%BC%8F/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8C%83%E5%BC%8F/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li><p>几个重要知识点</p>
<ul>
<li><p>平凡函数依赖与非平凡函数依赖</p>
<ul>
<li>X→Y，但Y⊈X则称X→Y是非平凡的函数依赖。</li>
<li>X→Y，但Y⊆X 则称X→Y是平凡的函数依赖。</li>
</ul>
</li>
<li><p>完全函数依赖与部分函数依赖</p>
<p>在R(U)中，</p>
<ul>
<li>如果X→Y，并且对于X的任何一个真子集X’, 都有 X’ ↛ Y, 则称Y对X完全函数依赖，记作X → Y。</li>
<li>若X→Y，但Y不完全函数依赖于X，则称Y对X部分函数依赖，记作X → Y</li>
</ul>
</li>
<li><p><font color=red>候选码</font></p>
<p>设K为R&lt;U,F&gt;中的属性或属性组合。若K → U，则K称为R的一个候选码(Candidate Key)。</p>
<p><font color=red>千万需要记住的是候选码与超码之间的区别</font></p>
</li>
<li><p><font color=red>超码</font></p>
<p>如果U部分函数依赖于K，即K → U,则K称为超码(Surpkey)。</p>
<p><strong>候选码是最小的超码</strong>，即K的任意一个真子集都不是候选码。</p>
</li>
<li><p><font color=red>主码</font></p>
<p>主码是候选码中的任意一个</p>
</li>
<li><p>主属性与非主属性</p>
<ul>
<li>包含在任何一个候选码中的属性 ，称为主属性（Prime attribute） </li>
<li>不包含在任何码中的属性称为非主属性（Nonprime attribute）或非码属性（Non-key attribute） </li>
</ul>
</li>
<li><p>全码</p>
<p>整个属性组是码，称为全码（All-key） </p>
</li>
</ul>
</li>
<li><p>范式</p>
<ul>
<li><p>第一范式</p>
<p>每个属性不可分割</p>
</li>
<li><p>第二范式</p>
<p>若关系模式R∈1NF，并且每一个<strong>非主属性</strong>都<strong>完全函数依赖</strong>于任何一个候选码，则R∈2NF</p>
</li>
<li><p>第三范式</p>
<p>消除非主属性对于码的传递依赖<br>若R中不存在这样的码X、属性组Y及非主属性Z（Z ⊇ Y）, 使得X→Y，Y→Z成立，<font color=red>Y ↛ X不成立</font>，则称R&lt;U,F&gt; ∈ 3NF。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/sumaliqinghua/article/details/86246762">三范式分解</a></p>
</li>
<li><p>BC范式</p>
<p>消除主属性对码的部分和传递函数依赖</p>
<p>判断：在关系模式R&lt;U,F&gt;中，如果每一个决定属性集都<strong>包含候选码</strong>，则R∈BCNF。</p>
</li>
</ul>
<ol start="3">
<li><p>无损连接与保持函数依赖性</p>
<ul>
<li>无损连接</li>
</ul>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210103115115.png" alt="image-20210103115106959"></p>
<p>​    <a target="_blank" rel="noopener" href="https://blog.csdn.net/nailuoch/article/details/94214673">无损连接判断</a></p>
<ul>
<li><p>保持函数依赖性</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210103115439.png" alt="image-20210103115438081"></p>
<p>分解后带到的各个集合推导出的函数依赖看是否能够推导出原来的函数依赖</p>
</li>
</ul>
</li>
</ol>
<p>​        <font color=red>一个无损连接的分解不一定具有依赖保持性，反之亦然 !</font></p>
<ol start="4">
<li><p>三范式分解(<font color=red>范式分解最终的答案并非是唯一的，和分解的顺序有关！</font>)</p>
<ul>
<li><p>三范式分解为保持函数依赖的分解</p>
<p>步骤如下：</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210103151010.png" alt="image-20210103151008580"></p>
<p>例题：</p>
<p>设R&lt;U, F&gt;，其中：</p>
<pre><code>      U=&#123;C, T, H, R, S, G, X, Y, Z&#125;, 
      F=&#123;C→T, CS→G, HR→C，HS→ R, TH→ R, C→X&#125;，  
</code></pre>
<p>​          将R 分解为3NF，且保持函数依赖。 </p>
<p>解：</p>
<ol>
<li><p>求F的最小函数依赖集</p>
<p> 该函数依赖集已经是最小化的</p>
</li>
</ol>
<pre><code>2. 查看是否有一个函数依赖X-&gt;A，且XA=R。

可以很清楚的看到，并没有这种函数依赖。

3. 查看R中的某些属性是否并不在F中出现过

可以很清楚的看到有YZ

4. 将最小函数依赖集中的每一个依赖左右两边放到一起

则分解为ρ =&#123;YZ, CTX, CSG, HRC, HSR, THR&#125;  

注：这里的CTX放到一起时因为C$\rightarrow$T，C$\rightarrow$X
</code></pre>
</li>
<li><p>三范式分解既具有无损连接性又能保持函数依赖的分解 </p>
<p><strong>非常简单！在原来的基础上加上候选码中的任意一个即可。</strong></p>
<p>例如此题中的候选码为HS</p>
<p>那么在原来的ρ中添加HS即可，但是此处需要<font color=red>注意</font></p>
<p>∵ HS⊆ HSR<br>∴ τ= ρ ={CTX, CSG, HRC, HSR, THR, YZ}为满足要求的分解</p>
</li>
</ul>
</li>
<li><p>BCNF分解(<font color=red>范式分解最终的答案并非是唯一的，和分解的顺序有关！</font>)</p>
<ul>
<li><p>如何判定BCNF范式呢？</p>
<p>很简单！就是看<font color=red>每个</font>函数依赖的左边是否包含候选码，如果其中有一个不含候选码，则不为BCNF范式。</p>
</li>
<li><p>将关系模式转换为BCNF 的无损连接的分解</p>
<img src="/Users/cooper/Library/Application Support/typora-user-images/image-20210103152046863.png" alt="image-20210103152046863" style="zoom:50%;" />

<p>​    递归下去，直到出现$\Phi$或者出现最终的一个依赖符合BCNF约束则停止分解</p>
<p>​    例子1：</p>
<p>​    已知 R (A, B, C), AB为码, 且B-&gt;C存在<br>​    可知：R不满足BCNF<br>​    设 $\alpha$ = B, $\beta$ = C<br>​    则 R 可分解为：<br>​    ($\alpha$$\bigcup$ $\beta$) = (B, C)<br>​    (R – ($\beta$ $-$$\alpha$)) = (A, B)</p>
<p>​    例子2：</p>
<p>​    <img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210103154219.png" alt="image-20210103154210971" style="zoom:50%;" />    </p>
</li>
</ul>
</li>
</ol>
</li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/MySQL/MySQL%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/MySQL/MySQL%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/" class="post-title-link" itemprop="url">MySQL存储引擎</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-07 08:43:29" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-27 22:40:40" itemprop="dateModified" datetime="2021-08-27T22:40:40+08:00">2021-08-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/MySQL/MySQL%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/MySQL/MySQL%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>336</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><p>InnoDB</p>
<p>特点</p>
<ul>
<li>行锁设计</li>
<li>支持外键</li>
<li>读取操作不会产生锁</li>
</ul>
</li>
<li><p>MyISAM</p>
<ul>
<li>不支持事物</li>
<li>表锁设计</li>
<li>支持全文索引</li>
<li>主要面向一些olap数据库应用</li>
</ul>
</li>
<li><p>NDB</p>
<p>主要用于MySQL cluster中</p>
<p>storage 层的NDB 数据节点，也就是上面说的NDB Cluster：<br>NDB 是一个内存式存储引擎也就是说，他会将所有的数据和索引数据都load 到内存中，<br>但也会将数据持久化到存储设备上。不过，最新版本，已经支持用户自己选择数据可以不全<br>部Load 到内存中了，</p>
</li>
<li><p>Memory</p>
<p>将表中的数据都存放到内存中</p>
</li>
<li><p>Archive</p>
<p>只支持insert个select操作</p>
<p>比较适合归档存储，比如日志信息</p>
</li>
<li><p>Federated</p>
<p>存储引擎表不存放数据，只是指向一台远程mysql数据库服务器上的表</p>
</li>
<li><p>查看当前mysql支持的引擎</p>
<p><code>show engines\G</code></p>
</li>
</ul>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/MySQL/InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/MySQL/InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%96%87%E4%BB%B6/" class="post-title-link" itemprop="url">InnoDB存储引擎文件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-07 08:43:29" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-19 17:12:56" itemprop="dateModified" datetime="2021-12-19T17:12:56+08:00">2021-12-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/MySQL/InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%96%87%E4%BB%B6/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/MySQL/InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%96%87%E4%BB%B6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>797</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="表空间文件"><a href="#表空间文件" class="headerlink" title="表空间文件"></a>表空间文件</h4><ul>
<li><p>系统表空间包含数据字典，双写缓冲，变更缓冲区、undo日志，以及在系统表空间创建的表的数据和索引。</p>
</li>
<li><p>名字为ibdata1</p>
</li>
</ul>
<h4 id="独立表空间文件"><a href="#独立表空间文件" class="headerlink" title="独立表空间文件"></a>独立表空间文件</h4><ul>
<li>存储该表的数据、索引和插入缓冲BITMAP等信息</li>
<li>名字为表名.ibd</li>
</ul>
<h4 id="重做日志文件"><a href="#重做日志文件" class="headerlink" title="重做日志文件"></a>重做日志文件</h4><ul>
<li><p>名字</p>
<p>ib_logfile0和ib_logfile1</p>
</li>
<li><p>每个InnoDB存储引擎至少有一个重做日志文件组，每个文件组下至少有2个重做日志文件（默认的ib_logfile0和ib_logfile1）。</p>
<p>可以根据需要设置多个镜像日志组，将不同的文件组放到不同的磁盘上。</p>
<p>日志组中的每个重做日志文件大小一致，并以写循环的方式运行。当重做日志1写满之后会往重做日志2写，最终2写满会往1写</p>
</li>
<li><p>对应参数</p>
<ul>
<li><p>innodb_log_file_size</p>
<p>这个参数对于存储引擎的性能影响十分大</p>
<ul>
<li>一方面不能设置的很大，否则恢复时间很长</li>
<li>不能设置很小，否则会经常切换</li>
</ul>
</li>
<li><p>innodb_log_files_in_group</p>
</li>
<li><p>innodb_mirrored_log_groups</p>
</li>
<li><p>innodb_log_group_home_dir</p>
</li>
</ul>
</li>
<li><p>与二进制文件的不同点</p>
<ul>
<li><p>对象不同</p>
<p>二进制日志记录所有MySQL有关的日志记录，包括其他引擎的，但redo log只记录该引擎本身的事务日志</p>
</li>
<li><p>内容不同</p>
<p>二进制日志记录的是逻辑日志，redo log记录的是关于每个页的更改的物理情况</p>
</li>
<li><p>时机不同</p>
<p>二进制日志在事务提交前提交，redo log记录的是在事务进行过程中，不断有重做日志记录到redo log中</p>
</li>
</ul>
</li>
<li><p>写入时机</p>
<ul>
<li><p>master thread 每秒将重做日志缓冲写入磁盘的重做日志文件中，不论事务是否已经提交</p>
</li>
<li><p>根据<code>innodb_flush_log_at_trx_commit</code>控制在commit操作时，处理重做日志的方式</p>
<ul>
<li><p>0</p>
<p>提交事务时，不将事务的重做日志写入到磁盘文件中，而是等待master thread的刷新</p>
</li>
<li><p>1</p>
<p>提交事务时将日志缓冲同步写到磁盘，伴有fsync操作</p>
</li>
<li><p>2</p>
<p>和1相比，没有fsync操作</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/MySQL/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/MySQL/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">MySQL性能分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-07 08:43:29" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-10-25 10:06:29" itemprop="dateModified" datetime="2021-10-25T10:06:29+08:00">2021-10-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/MySQL/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/MySQL/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="性能分析"><a href="#性能分析" class="headerlink" title="性能分析"></a>性能分析</h2><ol>
<li><p>性能下降的原因</p>
<ul>
<li>查询语句烂</li>
<li>索引失效</li>
<li>关联查询太多的join</li>
<li>服务器调优及各个参数设置（缓存、线程数等）</li>
</ul>
</li>
<li><p>性能优化</p>
<p> MySQL的常见瓶颈：</p>
<ul>
<li><p>CPU</p>
<p>CPU在饱和的时候一般发送在数据装入内存或从磁盘上读取数据的时候</p>
</li>
<li><p>IO</p>
<p>磁盘I/O瓶颈发送在装入数据远大于内存容量的时候</p>
</li>
<li><p>服务器硬件的性能瓶颈</p>
<p>top,free,iostat和vmstat来查看系统的性能状态</p>
</li>
</ul>
</li>
</ol>
<h3 id="explain"><a href="#explain" class="headerlink" title="explain"></a>explain</h3><ol>
<li><p>体现</p>
<ul>
<li>表的读取顺序</li>
<li>数据读取操作的操作类型</li>
<li>哪些索引可以使用</li>
<li>哪些索引可以被实际使用</li>
<li>表之间的引用</li>
<li>每张表有多少行被优化器查询</li>
</ul>
</li>
<li><p>explain表头</p>
<img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210221214028.png" alt="image-20210221214023521" style="zoom:50%;" />

<ul>
<li><p>id</p>
<ul>
<li>id值相同则按照从上往下的顺序依次执行</li>
<li>id值不同，id值越大则执行优先级越高，越先被执行</li>
</ul>
</li>
<li><p>select_type</p>
<ul>
<li><p>simpe</p>
<p>简单的select查询，查询中不包含子查询或者union</p>
</li>
<li><p>primary</p>
<p>查询中若包含任何复杂的子查询部分，则最外层的查询标记为primary</p>
</li>
<li><p>subquery</p>
<p>在select或where列表中包含了子查询</p>
</li>
<li><p>derived</p>
<p>在from列表中包含的子查询被标记为derived（衍生），MySQL会递归执行这些子查询，把结果放在临时表里</p>
</li>
<li><p>union</p>
<ul>
<li><p>若第二个select出现在union之后，则被标记为union</p>
</li>
<li><p>若union包含在from子句的子查询中，外层select将被标记为derived</p>
</li>
</ul>
</li>
<li><p>union result</p>
<p>从union表获取结果的select</p>
</li>
</ul>
</li>
<li><p>table</p>
<p>表</p>
</li>
<li><p>type</p>
<p>从最好到最差的顺序为：</p>
<p>system&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;ALL</p>
<p>一般来说，得保证查询至少达到range级别，最好达到ref</p>
<ul>
<li><p>system</p>
<p>表只有一行记录（等于系统表），这是const类型的特例，平时不会出现，可以忽略不计</p>
</li>
<li><p>const</p>
<p>表示通过索引一次就找到了，const用于比较primary key或者unique索引。因为只匹配一行数据，所以很快</p>
<p>如将主键置于where列表中，MySQL就能将该查询转换为一个常量</p>
<img src="/Users/cooper/Library/Application Support/typora-user-images/image-20210221222922269.png" alt="image-20210221222922269" style="zoom:50%;" /></li>
<li><p>eq_ref</p>
<p>唯一性索引扫描，对于每一个索引键，表中只有一条记录与之匹配，常见于主键或唯一索引扫描</p>
<p>什么情况下结果集只有一个呢！那便是使用了主键或者唯一性索引进行查找的情况</p>
</li>
<li><p>ref</p>
<p>非唯一性索引扫描，返回匹配某个单独值的所有行</p>
<p>本质上也是一种<font color=red>索引访问</font>，它返回所有匹配某个单独值的行，然后它可能会找到多个符合条件的行，所以他应该属于查找和扫描的混合体</p>
<p>出现该连接类型的条件是： 查找条件列使用了索引而且不为主键和unique。其实，意思就是虽然使用了索引，但该索引列的值并不唯一，有重复。这样即使使用索引快速查找到了第一条数据，仍然不能停止，要进行目标值附近的小范围扫描。但它的好处是它并不需要扫全表，因为索引是有序的，即便有重复值，也是在一个非常小的范围内扫描。下面为了演示这种情形，给employee表中的name列添加一个普通的key（值允许重复）</p>
</li>
<li><p>range</p>
<p>range指的是有范围的索引扫描，相对于index的全索引扫描，它有范围限制，因此要优于index。关于range比较容易理解，需要记住的是出现了range，则一定是<font color=red>基于索引</font>的。同时除了显而易见的between，and以及’&gt;’,’&lt;’外，in和or也是索引范围扫描。</p>
<p>它避免了全表扫描，只需要开始于索引的某一点到另一点，不要全部扫描索引</p>
</li>
<li><p>index</p>
<p>遍历索引数</p>
</li>
<li><p>all</p>
<p>全表扫描</p>
</li>
</ul>
</li>
<li><p>possible_keys</p>
<p>可能应用在这张表中的索引，一个或者多个</p>
<p>查询涉及到的字段上若存在索引，则该索引将被列出，<font color=red>但是不一定被实际查询使用</font></p>
</li>
<li><p>key</p>
<p>实际使用的索引，如果为NULL，则没有使用索引</p>
<p>查询中若使用了覆盖索引，则该索引<font color=red>仅</font>出现在key列表中</p>
</li>
<li><p>key_len</p>
<p>表示索引中使用的字节数，可以通过该列计算查询中使用的索引的长度。在不损失精确性的情况下，长度越短越好</p>
<p>key_len显示的值为索引字段的最大可能长度，并非实际使用长度，即key_len是根据表定义计算而得，不是通过表内检索出的</p>
</li>
<li><p>ref</p>
<p>显示索引的哪一列被使用了，如果可能的话，是一个常数。哪些列或常量被用于查找索引列上的值</p>
</li>
<li><p>rows</p>
<p>根据表统计信息及索引选用情况，大致估算出找到所需的记录所需要读取的行数</p>
</li>
<li><p>extra</p>
<p>包含不适合在其他列中显示但十分重要的额外信息</p>
<ul>
<li><p>using filesort （<font color=red>出现这个表示很危险！！</font>）<br>说明MySQL会对数据使用一个外部的索引排序，而不是按照表内的索引顺序进行读取。MySQL中无法利用索引完成的排序操作称为“文件排序”</p>
<img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210222141839.png" alt="Snipaste_2021-02-22_14-16-24" style="zoom:50%;" /></li>
<li><p>using temporary （<font color=red>出现这个表示非常危险！！</font>）</p>
<p>使用了临时表保存中间结果，MySQL在对查询结果排序时使用临时表。</p>
<p>常见于排序order by和分组查询group by</p>
</li>
<li><p>using index</p>
<p>表示相应的select操作中使用了覆盖索引，避免访问了表的数据行，效率不错。</p>
<p>如果同时出现了using where，表明索引被用来执行索引键值的查找</p>
<p>如果没有同时出现using where，表明索引用来读取数据而非执行查找动作</p>
<p>覆盖索引：<font color=red>查询列要被所建的索引覆盖</font></p>
</li>
<li><p>using index condition</p>
<p>Using index condition 会过滤索引后找到所有符合索引条件的数据行，随后用 where子句中的其他条件去过滤这些数据行，用到了ICP</p>
<p>关闭ICP是这样的：1. 从索引里面取出下一条pid=14的记录，然后利用主键字段读取整个行。2. 然后对这个完整的行利用其余的条件这个进行判断看是否符合条件，在Server层进行过滤和处理。开启ICP是这样的：1. 从索引里面取出下一条pid=14的记录，然后利用这个索引的其他字段条件进行判断，如果条件成立，执行第2步。在引擎层上进行过滤和处理。2. 在上一步中筛选出来符合条件的才会利用主键索引里面找到这个完整行，返回。</p>
</li>
<li><p>using where</p>
<p>MySQL将对存储引擎层提取的结果进行过滤，过滤条件字段无索引。有可能产生回表。只有在使用了索引，且Extra是Using where的情况下，才代表回表查询数据</p>
</li>
<li><p>using join buffer</p>
<p>使用了连接缓存</p>
<p>如果join比较多了，可以调大配置中的join buffer</p>
</li>
<li><p>impossible where</p>
<p>where子句的值总是false，不能用来获取任何元组</p>
</li>
<li><p>select tables optimized away</p>
<p>在没有groupby子句的情况下，基于索引优化min/max操作获取或者</p>
<p>对于myisam存储引擎优化count(*)操作</p>
<p>不必等到执行阶段再进行计算，查询执行计划生成的阶段即完成了优化</p>
</li>
<li><p>distinct</p>
<p>优化distinct操作，在找到第一匹配的元组后即停止找同样值的动作</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/MySQL/MySQL%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/MySQL/MySQL%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/" class="post-title-link" itemprop="url">MySQL备份与恢复</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-07 08:43:29" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-31 15:42:30" itemprop="dateModified" datetime="2021-08-31T15:42:30+08:00">2021-08-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/MySQL/MySQL%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/MySQL/MySQL%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h3><h4 id="几个概念"><a href="#几个概念" class="headerlink" title="几个概念"></a>几个概念</h4><ul>
<li><p>热备</p>
<p>在数据库运行中直接备份，对数据库没有任何影响</p>
</li>
<li><p>冷备</p>
<p>在数据库停止的情况下进行备份</p>
</li>
<li><p>温备</p>
<p>在数据库运行中直接备份，对数据库有一定的影响</p>
</li>
<li><p>逻辑备份</p>
<p>内容一般由sql语句组成或者由表内实际数据组成</p>
</li>
<li><p>裸文件备份</p>
<p>复制数据库的物理文件</p>
</li>
</ul>
<h3 id="逻辑备份"><a href="#逻辑备份" class="headerlink" title="逻辑备份"></a>逻辑备份</h3><h4 id="mysqldump"><a href="#mysqldump" class="headerlink" title="mysqldump"></a>mysqldump</h4><p>  <font color=red>mysqldump 无法导出视图</font></p>
<p><code>mysqldump -uroot -p &#123;参数&#125; &#123;database 名&#125; &#123;表名&#125; &gt; &#123;sql文件&#125;</code></p>
<ul>
<li><p>只生成创建表结构的语句 (-d)</p>
<p><code>mysqldump -uroot -p -d lmis md_goods_type &gt; goods_d.sql</code></p>
</li>
<li><p>只生成插入数据的语句 (-t)</p>
<p><code>mysqldump -uroot -p123456 -t lmis md_goods_type &gt; goods_t.sql </code></p>
</li>
<li><p>自动生成两个文件：一个.sql文件，创建表结构的语句；一个.txt文件，数据文件，相当于select into outfile (-t)</p>
<p><code>mysqldump -uroot -p123456 -T /tmp lmis md_goods_type </code></p>
</li>
<li><p>完整生成sql (包含表结构语句和插入数据的语句)</p>
<p><code>mysqldump -u root -p lmis &gt; goods.sql</code></p>
</li>
</ul>
<h4 id="select-…-into-outfile"><a href="#select-…-into-outfile" class="headerlink" title="select … into outfile"></a>select … into outfile</h4><p>主要作用是导出一张表中的数据，只有数据</p>
<p><code>select * into outfile &#39;/root/a.txt&#39; from a</code></p>
<p>这里需要注意一下，有可能提示The MySQL server is running with the –secure-file-priv option so it cannot execute this statement </p>
<p>一些版本的mysql对通过文件导入导出作了限制，默认不允许，</p>
<p>查看配置，执行mysql命令</p>
<p>SHOW VARIABLES LIKE “secure_file_priv”;</p>
<p>如果value值为null，则为禁止，如果有文件夹目录，则只允许改目录下文件（测试子目录也不行），如果为空，则不限制目录；</p>
<p>修改配置可修改mysql配置文件，查看是否有</p>
<p>secure_file_priv = </p>
<p>这样一行内容，如果没有，则手动添加，</p>
<p>secure_file_priv = /home </p>
<p>表示限制为/home文件夹</p>
<p>secure_file_priv = </p>
<p>表示不限制目录，等号一定要有，否则mysql无法启动</p>
<p>修改完配置文件后，重启mysql生效</p>
<h3 id="逻辑恢复"><a href="#逻辑恢复" class="headerlink" title="逻辑恢复"></a>逻辑恢复</h3><ul>
<li><p><code>mysql -u root -p &lt;xxx.sql </code>（mysql下）</p>
</li>
<li><p><code>source /home/mysql/test.sql</code>  （mysql下）</p>
</li>
<li><p><code>load data infile &#39;/var/lib/mysql-files/tt1.txt&#39; into table tt</code> （mysql下）</p>
<p>数据文件必须是<code>select ... into outfile</code> 导出的格式，同时存放的路径也必须是<code>secure_file_priv</code> 下</p>
<p>导入希望忽略对外键的检查</p>
<p><code>set @@foreign_key_checks=0</code></p>
</li>
<li><p><code>mysqlimport --use-thread=&#123;number&#125; db_name textfile1[textfile2...]</code> （shell下）</p>
<p>此处的–use-thread指的是导入时使用的线程数，并发指的是多张表同时导入，不是指一张表的并发导入</p>
</li>
<li><p>binlog的恢复</p>
<p><code>mysqlbinlog binlog.[0-10]* |mysql -u root -p</code></p>
<p>也可以将其导出成sql文件</p>
<p><code>mysqlbinlog binlog.xxx &gt; /tmp/xxx.sql</code></p>
<p>当然也可以选择指定二进制的偏移量或者日期来进行导入</p>
<ul>
<li><p>偏移量</p>
<p><code>mysqlbinlog --start-position=xxxx binlog.xxxx |mysql -u root -p</code></p>
</li>
<li><p>日期</p>
<p><code>mysqlbinlog --start-datetime=xxxx binlog.xxx |mysql -u root -p</code></p>
</li>
</ul>
</li>
</ul>
<h3 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h3><h4 id="复制的原理"><a href="#复制的原理" class="headerlink" title="复制的原理"></a>复制的原理</h4><ul>
<li>主服务器把数据更改记录到二进制日志中</li>
<li>从服务器把主服务器的二进制日志复制到自己的中继日志中</li>
<li>从服务器重做中继日志中的日志，把更改应用到自己的数据库上，已到达数据的最终一致性</li>
</ul>
<h4 id="从服务器的线程"><a href="#从服务器的线程" class="headerlink" title="从服务器的线程"></a>从服务器的线程</h4><ul>
<li><p>I/O线程</p>
<p>负责读取主服务器的二进制日志，并将其保存为中继日志</p>
</li>
<li><p>SQL线程</p>
<p>复制执行中继日志</p>
</li>
</ul>
<p><font color=red>注意：复制并非是完全实时同步的，而是异步实时的</font></p>
<h4 id="查看主从延迟程度"><a href="#查看主从延迟程度" class="headerlink" title="查看主从延迟程度"></a>查看主从延迟程度</h4><p><code>show slave status\G</code>得到<code>Read_Master_Log_Pos</code></p>
<p><code>show master status\G</code>得到<code>Position</code></p>
<p>后者减去前者得到的就是延迟</p>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/MySQL/InnoDB%E6%95%B0%E6%8D%AE%E9%A1%B5%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/MySQL/InnoDB%E6%95%B0%E6%8D%AE%E9%A1%B5%E7%BB%93%E6%9E%84/" class="post-title-link" itemprop="url">InnoDB数据页结构</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-07 08:43:29" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-27 22:39:32" itemprop="dateModified" datetime="2021-08-27T22:39:32+08:00">2021-08-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/MySQL/InnoDB%E6%95%B0%E6%8D%AE%E9%A1%B5%E7%BB%93%E6%9E%84/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/MySQL/InnoDB%E6%95%B0%E6%8D%AE%E9%A1%B5%E7%BB%93%E6%9E%84/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="数据页结构"><a href="#数据页结构" class="headerlink" title="数据页结构"></a>数据页结构</h3><ul>
<li><p>结构</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210804114435.png" alt="image.png"></p>
</li>
<li><p>参考</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="http://blog.itpub.net/70000438/viewspace-2783582/">http://blog.itpub.net/70000438/viewspace-2783582/</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6974225353371975693">https://juejin.cn/post/6974225353371975693</a></p>
</li>
</ul>
</li>
</ul>
<h4 id="File-Header"><a href="#File-Header" class="headerlink" title="File Header"></a>File Header</h4><ul>
<li><p>功能</p>
<p>记录页的一些头信息</p>
</li>
<li><p>结构</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210804100947.png" alt="image-20210804100945854"></p>
</li>
</ul>
<h4 id="Page-Header"><a href="#Page-Header" class="headerlink" title="Page Header"></a>Page Header</h4><ul>
<li><p>功能</p>
<p>记录数据页的状态信息</p>
</li>
<li><p>结构</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210804101018.png" alt="image-20210804101016996"></p>
</li>
</ul>
<h4 id="行记录"><a href="#行记录" class="headerlink" title="行记录"></a>行记录</h4><h5 id="Infimum-amp-Supremum-Records"><a href="#Infimum-amp-Supremum-Records" class="headerlink" title="Infimum&amp;Supremum Records"></a>Infimum&amp;Supremum Records</h5><ul>
<li><p>功能</p>
<p>限定记录的边界</p>
</li>
<li><p>创建时机</p>
<p>在数据页被初始化的时候，就会在数据页最后(当然在checksum之前)创建两个数据目录，分别指向最小和最大记录</p>
</li>
<li><p>Infimum Record</p>
<p>比任何主键值都要小的值</p>
</li>
<li><p>Supremum Record</p>
<p>比任何主键值都要大的值</p>
</li>
</ul>
<h5 id="User-Records"><a href="#User-Records" class="headerlink" title="User Records"></a>User Records</h5><p>实际存储行记录的内容</p>
<h5 id="Free-Space"><a href="#Free-Space" class="headerlink" title="Free Space"></a>Free Space</h5><ul>
<li><p>每当插入一条记录，就会从<code>Free Space</code>部分中申请一个记录大小的空间到<code>User Records</code>部分，当 Free Space 部分的空间用完之后，这个页也就使用完了。</p>
</li>
<li><p>在一条记录被删除后，该空间会被加入到空闲链表(Free Space)中</p>
</li>
</ul>
<h4 id="Page-Directory"><a href="#Page-Directory" class="headerlink" title="Page Directory"></a>Page Directory</h4><p>用户的记录是从低地址向高地址扩展，而数据目录则相反。在数据页被初始化的时候，就会在数据页最后(当然在checksum之前)创建两个数据目录，分别指向最大和最小记录。之后插入新的数据的时候，需要维护这个目录，例如必要的时候增加目录的个数。每个数据目录占用两个字节，存储对应记录的页内偏移量。假设目录N，这个目录N管理目录N-1(不包括)和目录N之间的记录，我们称目录N own 这些记录。在目录N指向的记录中，会有字段记录own记录的数量。由此可见，目录own的记录不能太多，因为太多的话，即意味着目录太过稀疏，不能很好的提高查询效率，但同时也不能own太少，这会导致目录数量变多，占用过多的空间。在InnoDB的实现中，目录own的记录数量在4-8之间，包括4和8，平均是6个记录。如果超过这个数量，就需要重新均衡目录的数量。目录的增加和删除可能需要进行内存拷贝，但是由于目录占用的总体空间很小，开销可以忽略不计。</p>
<p><font color=red>注意：B+树索引本身并不能具体的找到一条记录，能找到的只是该记录所在的页。数据库找到页之后将其载入到内存中，然后通过Page Directory再进行二分查找，由于这部分查找很快因为通常忽略不计。</font></p>
<ul>
<li><p>例子</p>
<p>比方说我们想找主键值为6的记录</p>
<ol>
<li><p>计算中间槽的位置：(0+4)/2=2，所以查看槽2对应记录的主键值为8，又因为8 &gt; 6，所以设置high=2，low保持不变。</p>
</li>
<li><p>重新计算中间槽的位置：(0+2)/2=1，所以查看槽1对应的主键值为4，又因为4 &lt; 6，所以设置low=1，high保持不变。</p>
</li>
<li><p>因为high - low的值为1，所以确定主键值为6的记录在槽2对应的组中。此刻我们需要找到槽2中主键值最小的那条记录，然后沿着单向链表遍历槽2中的记录。</p>
</li>
<li><p>我们可以拿到槽1对应的记录（主键值为4），该条记录的下一条记录就是槽2中主键值最小的记录，该记录的主键值为5。所以我们可以从这条主键值为5的记录出发，遍历槽2中的各条记录，直到找到主键值为6的那条记录即可。由于一个组中包含的记录条数只能是1~8条，所以遍历一个组中的记录的代价是很小的。</p>
</li>
</ol>
</li>
</ul>
<h4 id="File-Trailer"><a href="#File-Trailer" class="headerlink" title="File Trailer"></a>File Trailer</h4><ul>
<li><p>功能</p>
<p>检测页是否已经完整的写入磁盘，在默认配置下每从磁盘读取一个页就会检测该页的完整性，可以通过<code>innodb_checksums</code>将该功能关闭</p>
</li>
</ul>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/MySQL/CheckPoint/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/MySQL/CheckPoint/" class="post-title-link" itemprop="url">CheckPoint</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-07 08:43:29" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-27 22:38:57" itemprop="dateModified" datetime="2021-08-27T22:38:57+08:00">2021-08-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/MySQL/CheckPoint/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/MySQL/CheckPoint/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>662</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="检查点的作用"><a href="#检查点的作用" class="headerlink" title="检查点的作用"></a>检查点的作用</h3><ul>
<li>缩短数据库的恢复时间</li>
<li>缓冲池不够用时，将脏页刷新到磁盘</li>
<li>重做日志不可用时，刷新脏页</li>
</ul>
<h3 id="CheckPoint的种类"><a href="#CheckPoint的种类" class="headerlink" title="CheckPoint的种类"></a>CheckPoint的种类</h3><ul>
<li><p>Sharp Checkpoint</p>
<p>数据库关闭时会将所有的脏页都刷新会磁盘</p>
<p>对应参数：innodb_fast_shutdown = 1</p>
</li>
<li><p>Fuzzy Checkpoint</p>
<p>只刷新一部分脏页</p>
<p>触发时机：</p>
<ul>
<li><p>master thread checkpoint</p>
<p>每秒或者每10秒的速度从缓冲池的脏页列表刷新一定比例的页回磁盘 （异步）</p>
</li>
<li><p>Flush_LRU_LIST checkpoint</p>
<p>InnoDB需要保证LRU列表中需要有100个空闲页可供使用，如果小于该数字，则需要将LRU列表尾端的页移除，如果其中存在脏页，那么需要Checkpoint</p>
<p>该检查被放到Page Cleaner线程中进行</p>
<p>对应参数：innodb_lru_scan_depth</p>
<p><code>show variables like &#39;innodb_lru_scan_depth&#39;;</code></p>
</li>
<li><p>Async/Sync Flush Checkpoint</p>
<p>发生在重做日志不可用的情况，需要强制将一些页刷新会磁盘，而此时脏页是从脏页列表中选取的，这可以保证重做日志文件可循环使用（因为重做日志大小是有限的）</p>
<p>触发的时机如下：</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210714110708.png" alt="image-20210714110636273"></p>
<p>​        可以通过<code>show engine innodb status\G</code></p>
<p>​        中的async flush 和 sync flush查看</p>
</li>
<li><p>Dirty Page too much Checkpoint</p>
<p>当脏页太多时触发</p>
<p>对应参数innodb_max_dirty_pages_pct</p>
<p>当缓冲池中的脏页数量的占比达到75%的时候会触发CheckPoint</p>
</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%81%A2%E5%A4%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%81%A2%E5%A4%8D/" class="post-title-link" itemprop="url">数据库恢复</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-07 08:43:29" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-13 08:27:21" itemprop="dateModified" datetime="2021-02-13T08:27:21+08:00">2021-02-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%81%A2%E5%A4%8D/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%81%A2%E5%A4%8D/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>782</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><blockquote>
<p>定义</p>
</blockquote>
<ul>
<li><p>用户定义的一个对数据库读写操作序列</p>
</li>
<li><p>数据库中不可分割的执行单位</p>
</li>
<li><p>数据库恢复和并发控制的基本单位</p>
</li>
<li><p>数据库系统中通常有多个事务并行运行</p>
</li>
</ul>
<blockquote>
<p>事务的特性</p>
</blockquote>
<ul>
<li>原子性</li>
<li>一致性 （事务执行的结果必须使得数据库从一个一致性状态变到另一个一致性状态）</li>
<li>隔离性 （相互之间不能干扰）</li>
<li>持久性 （事务一旦提交，它对于数据库的更新不会受到后续操作或故障的影响）</li>
</ul>
<h3 id="操作原语"><a href="#操作原语" class="headerlink" title="操作原语"></a>操作原语</h3><ul>
<li><p>缓存区管理器（分配、管理和回收缓冲区，决定何时将缓冲区的数据写回磁盘（立即修改/延迟修改））</p>
<ul>
<li>Input(x) 包含数据元素x的磁盘块$\rightarrow$缓冲区</li>
<li>Output(x) 包含数据元素x的缓冲区$\rightarrow$磁盘</li>
</ul>
</li>
<li><p>事务</p>
<ul>
<li><p>Read(x,t)</p>
<p>缓冲区的数据元素x $\rightarrow$事务的局部变量t，</p>
<p>如果包含x的块不在缓冲区中，则先执行input(x)</p>
</li>
<li><p>Write(x,t)</p>
<p>事务的局部变量t$\rightarrow$缓冲区的数据元素x，</p>
<p>如果包含x的块不在缓冲区中，则先执行input(x)</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>各个管理器的作用</p>
</blockquote>
<img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210105180914.png" alt="image-20210105180909175" style="zoom:50%;" />

<h3 id="数据库恢复"><a href="#数据库恢复" class="headerlink" title="数据库恢复"></a>数据库恢复</h3><blockquote>
<p>常见故障</p>
</blockquote>
<ul>
<li>事务故障 </li>
<li>介质故障</li>
<li>系统故障</li>
</ul>
<blockquote>
<p>恢复技术</p>
</blockquote>
<ul>
<li><p>数据库恢复的基本原理</p>
<p><strong>利用存储在系统别处的冗余数据来重建</strong></p>
<p>主要包括：日志文件、数据备份</p>
</li>
</ul>
<blockquote>
<p>日志记录的几种形式</p>
</blockquote>
<p>Redo: 对已提交的事务进行重做</p>
<p>Undo：对未提交的事务进行撤销</p>
<img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210104163152.png" alt="image-20210104163147917" style="zoom:50%;" />

<ul>
<li><p>Undo日志规则</p>
<img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210104164215.png" alt="image-20210104164210273" style="zoom:50%;" /></li>
<li><p>Redo日志规则</p>
<img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210104164627.png" alt="image-20210104164622379" style="zoom:50%;" /></li>
<li><p>Undo与Redo的区别</p>
<img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210104164909.png" alt="image-20210104164905046" style="zoom:50%;" /></li>
</ul>
<blockquote>
<p>数据库恢复</p>
</blockquote>
<img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210104170615.png" alt="image-20210104170440808" style="zoom:50%;" />

<p><font color=red>注意一定是先要做Undo操作，再做Redo操作！</font></p>
<img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210104170615.png" alt="image-20210104170604389" style="zoom:50%;" />



<ul>
<li><p>出现的问题</p>
<ol>
<li>搜索整个日志耗费大量的时间</li>
<li>有些日志不再需要了</li>
</ol>
</li>
<li><p>解决方法</p>
<p>检查点技术</p>
<p>非静止检查点技术（可以在建立检查点的时候运行新的事务进入）</p>
</li>
</ul>
<blockquote>
<p>参考</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=X2ba9C9lCa4">https://www.youtube.com/watch?v=X2ba9C9lCa4</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=V1h6-PxLVz4">https://www.youtube.com/watch?v=V1h6-PxLVz4</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=PU22PPQUwkA">https://www.youtube.com/watch?v=PU22PPQUwkA</a> </p>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/20/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/">35</a><a class="extend next" rel="next" href="/page/22/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Cooper</p>
  <div class="site-description" itemprop="description">记录一些学习笔记、小说、随笔</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">341</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">75</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/CooperXJ" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CooperXJ" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1789023580@qq.com" title="E-Mail → mailto:1789023580@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cooper</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">648k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">9:49</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'rOzi1T6uncSYNdx0tp1owOzV-gzGzoHsz',
      appKey     : 'Fk3s6CQBK042e1QltClHnTBP',
      placeholder: "留下邮箱，有回复时你将收到提醒，邮箱不会被公开",
      avatar     : 'wavatar',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
