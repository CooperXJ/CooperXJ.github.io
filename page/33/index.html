<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"cooperxj.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="记录一些学习笔记、小说、随笔">
<meta property="og:type" content="website">
<meta property="og:title" content="Cooper Notes">
<meta property="og:url" content="http://cooperxj.github.io/page/33/index.html">
<meta property="og:site_name" content="Cooper Notes">
<meta property="og:description" content="记录一些学习笔记、小说、随笔">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Cooper">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://cooperxj.github.io/page/33/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Cooper Notes</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Cooper Notes</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">obey rules</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/rook/bluestore%E5%8A%A0%E9%80%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/rook/bluestore%E5%8A%A0%E9%80%9F/" class="post-title-link" itemprop="url">bluestore加速</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-07 08:43:29 / 修改时间：11:58:51" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rook/" itemprop="url" rel="index"><span itemprop="name">Rook</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/rook/bluestore%E5%8A%A0%E9%80%9F/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/rook/bluestore%E5%8A%A0%E9%80%9F/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>59</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>bluestore可以有通过SSD进行加速<br>对于bluestore加速需要将wal+db存储在SSD中，其起到加速的作用</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210711160937.png" alt="image-20210711160932038"></p>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/rook/rook%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/rook/rook%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5/" class="post-title-link" itemprop="url">rook调度策略</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-07 08:43:29 / 修改时间：11:59:16" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rook/" itemprop="url" rel="index"><span itemprop="name">Rook</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/rook/rook%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/rook/rook%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>705</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="出现的原因"><a href="#出现的原因" class="headerlink" title="出现的原因"></a>出现的原因</h3><p>不同组件对于机器的要求不一样，比如说mds对于CPU要求比较高，磁盘此致</p>
<p>相反osd节点对于磁盘和内存要求较高，CPU此致，因此在规划的时候需要根据不同的配置分配不同的节点</p>
<h3 id="rook提供的策略"><a href="#rook提供的策略" class="headerlink" title="rook提供的策略"></a>rook提供的策略</h3><ul>
<li><p>nodeAffinity</p>
<p>节点亲和力调度，根据label选择合适的调度节点</p>
</li>
<li><p>podAffinity</p>
<p>pods亲和力调度，将pods调度到具有相同性质类型的节点上</p>
</li>
<li><p>podAntiAffinity</p>
<p>pods反亲和力调度，将pods调度到与某些pods相反的节点</p>
</li>
<li><p>topologySpreadConstraints</p>
<p>拓扑选择调度</p>
</li>
<li><p>tolerations</p>
<p>污点容忍调度，允许调度到某些具有“污点”的节点上</p>
</li>
</ul>
<h3 id="rook支持的调度对象"><a href="#rook支持的调度对象" class="headerlink" title="rook支持的调度对象"></a>rook支持的调度对象</h3><ul>
<li>mon</li>
<li>mgr</li>
<li>osd</li>
<li>cleanup</li>
</ul>
<h3 id="定制mon调度参数"><a href="#定制mon调度参数" class="headerlink" title="定制mon调度参数"></a>定制mon调度参数</h3><p>修改cluster.yaml文件中的</p>
<ol>
<li></li>
</ol>
<img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210710120641.png" alt="image-20210710120636703" style="zoom:50%;" />

<ol start="2">
<li><img src="/Users/cooper/Library/Application Support/typora-user-images/image-20210710120723310.png" alt="image-20210710120723310" style="zoom:50%;" />

<p>这两个需要设为false </p>
</li>
<li><p>给符合条件的节点打上标签</p>
<p><code>kubectl label node node-1 ceph-mon = enabled</code></p>
</li>
</ol>
<h3 id="定制mgr调度参数"><a href="#定制mgr调度参数" class="headerlink" title="定制mgr调度参数"></a>定制mgr调度参数</h3> <img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210710122610.png" alt="image-20210710122606370" style="zoom:50%;" />

<p>基础的和mon调度参数设置类似，就是需要将mon改为mgr</p>
<h3 id="定制osd调度参数"><a href="#定制osd调度参数" class="headerlink" title="定制osd调度参数"></a>定制osd调度参数</h3><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210710123243.png" alt="image-20210710123236989" style="zoom:50%;" />

<p>注意：</p>
<ol>
<li>name需要是节点的标识，而不是ip地址</li>
<li>devcies<ul>
<li>name 磁盘名称</li>
<li>config 如果不自己设置，那么会默认使用第一个红色箭头指向的config中的设置，其里面的字段都可以在下面的中自己进行设置</li>
</ul>
</li>
</ol>
<p>注意：上面设置完之后就可以创建osd了，如果需要配合label的话往下看：</p>
<p>和mon还有mgr一样</p>
<img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210710123649.png" alt="image-20210710123644331" style="zoom:50%;" />



<p>如果使用了和mon还有mgr定制参数的一样的方法配置，那么需要将对应节点打上对应的标签，否则即使设置了osd中的nodes的参数，同样也是无法生效的，因为必须在满足标签的前提下，才会去执行osd中nodes的参数</p>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/rook/%E6%B8%85%E7%90%86rook%E9%9B%86%E7%BE%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/rook/%E6%B8%85%E7%90%86rook%E9%9B%86%E7%BE%A4/" class="post-title-link" itemprop="url">清理rook集群</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-07 08:43:29 / 修改时间：11:58:44" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rook/" itemprop="url" rel="index"><span itemprop="name">Rook</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/rook/%E6%B8%85%E7%90%86rook%E9%9B%86%E7%BE%A4/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/rook/%E6%B8%85%E7%90%86rook%E9%9B%86%E7%BE%A4/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>149</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li><p>删除yaml资源文件</p>
</li>
<li><p>删除对应的各个节点下的/var/lib/rook/文件</p>
</li>
<li><p>清理osd的盘</p>
<ul>
<li>lvs</li>
<li>vgs</li>
<li>vgremove 出现的盘</li>
<li>pvs</li>
<li>pvremove 出现的盘</li>
</ul>
</li>
<li><p>如果发现namespace中还是有rook-ceph</p>
<p>按下面执行</p>
<ol>
<li><p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210707225957.png" alt="image-20210707225957871"></p>
</li>
<li><p>删除红色箭头指向的字段（有两个红色箭头执行的都要删除掉）</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210707230055.png" alt="image-20210707230055096"></p>
</li>
</ol>
</li>
<li><p>osd对应磁盘的清理</p>
<p><a target="_blank" rel="noopener" href="https://rook.io/docs/rook/v1.4/ceph-teardown.html">参考</a></p>
<p>​    </p>
</li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/rook/%E5%AE%9A%E5%88%B6%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/rook/%E5%AE%9A%E5%88%B6%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6/" class="post-title-link" itemprop="url">Rook定制资源限制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-07 08:43:29 / 修改时间：11:58:02" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rook/" itemprop="url" rel="index"><span itemprop="name">Rook</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/rook/%E5%AE%9A%E5%88%B6%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/rook/%E5%AE%9A%E5%88%B6%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>279</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="定制资源限制的原因"><a href="#定制资源限制的原因" class="headerlink" title="定制资源限制的原因"></a>定制资源限制的原因</h3><p>因为如果在一个节点上既有osd又有mon还有mds，没有设置资源限制的话会导致</p>
<p>比如说osd占用的资源过大，有可能讲mon或者mgr的资源驱逐掉</p>
<p>==一句话就是可能会发生资源争抢的现象，从而导致有些核心资源被驱逐==</p>
<p>因此<strong>非常有必要确保各个组件分配到足够的资源</strong></p>
<h3 id="设置资源限制参数"><a href="#设置资源限制参数" class="headerlink" title="设置资源限制参数"></a>设置资源限制参数</h3><p>在cluster.yaml文件中进行设置</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210710125553.png" alt="image-20210710125552307"></p>
<p><font color=red>注意</font></p>
<ul>
<li><p>mon和mgr还有osd在设置完资源限制参数之后会==自动重启==，因此可以在创建之后进行设置，但是osd重启的速度==比较慢==</p>
</li>
<li><p>mon 生产环境内存推荐128G</p>
</li>
<li><p>osd 生产环境每T磁盘建议需要有4G内存，对于CPU的要求也比较高</p>
</li>
</ul>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/rook/%E8%B0%83%E4%BC%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/rook/%E8%B0%83%E4%BC%98/" class="post-title-link" itemprop="url">Rook调优</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-07 08:43:29 / 修改时间：11:58:20" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rook/" itemprop="url" rel="index"><span itemprop="name">Rook</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/rook/%E8%B0%83%E4%BC%98/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/rook/%E8%B0%83%E4%BC%98/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>585</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="临时调整ceph参数"><a href="#临时调整ceph参数" class="headerlink" title="临时调整ceph参数"></a>临时调整ceph参数</h3><p>和以前的配置差不多，主要你需要调整哪一个组件，那么就去哪一个组件的容器中去调整。</p>
<p>比如说我要调整mon中的配置信息，那么可以进入到mon的容器中</p>
<p>在/var/run/ceph 中有对应的xxx.asok</p>
<p><code>ceph --admin-daemon ceph-mon.a.asok config show</code></p>
<p>就可以展示出ceph的配置</p>
<p>mgr、rgw都类似</p>
<p><font color=red>需要注意的一点就是如果/etc/ceph路径下如果没有keyring文件的话是没有权限访问的，例如osd的pod中就没有，因此无法直接使用上面的命令连接到集群</font></p>
<p>每一个同种类型对应的容器都需要修改，如果需要修改的话</p>
<p><strong>当然上面的调整参数都是临时生效的，容器一但重启那么就会失效</strong></p>
<h3 id="永久调整ceph参数"><a href="#永久调整ceph参数" class="headerlink" title="永久调整ceph参数"></a>永久调整ceph参数</h3><p>使用<code>kubectl get configmaps -n rook-ceph</code></p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210711200508.png" alt="image-20210711200508121"></p>
<p>红色箭头指向的就是ceph的配置文件</p>
<p>我们可以在里面的data中进行修改，默认data是空的</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210711200642.png" alt="image-20210711200617291"></p>
<p>红色箭头执指向的区域就是我们修改配置文件的地方</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210711200817.png" alt="image-20210711200817601"></p>
<p>最终将这个文件apply一下就可以</p>
<p><strong>注意：配置完之后需要将每个组件进行重启：mon、mds、mgr、rgw、osd</strong></p>
<p><font color=red>除了osd之外每个容器在重启的时候最好一个一个重启, 等<code>ceph -s</code>为health的时候再进行下一个的重启osd一个一个重启，当重启一个osd之后需要等待所有的pg都是active+clean才能重启下一个</font></p>
<h3 id="生产环境中的参数"><a href="#生产环境中的参数" class="headerlink" title="生产环境中的参数"></a>生产环境中的参数</h3><p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210711202212.png" alt="image-20210711202212433"></p>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/rook/Rook-OSD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/rook/Rook-OSD/" class="post-title-link" itemprop="url">OSD</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-07 08:43:29 / 修改时间：11:59:06" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rook/" itemprop="url" rel="index"><span itemprop="name">Rook</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/rook/Rook-OSD/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/rook/Rook-OSD/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>380</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="扩容"><a href="#扩容" class="headerlink" title="扩容"></a>扩容</h3><ul>
<li>如果是增加了盘那么直接在cluster.yaml中对应的位置的对应的osd节点上添加上新增盘的信息</li>
</ul>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210711160005.png" alt="image-20210711155958522"></p>
<ul>
<li>如果是增加了节点那么直接在cluster.yaml中对应的位置的加上节点的信息以及其下面磁盘的信息</li>
</ul>
<h3 id="删除osd"><a href="#删除osd" class="headerlink" title="删除osd"></a>删除osd</h3><ol>
<li><p>直接使用ceph中的osd-purge.yaml</p>
<p>将对应osd的id写进入再apply一下即可完成删除osd的操作</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210711161702.png" alt="image-20210711161702220"></p>
<ol start="2">
<li><p>将cluster.yaml中对应的信息删除掉，如果是自己配置osd节点的话</p>
</li>
<li><p>有可能对应的osd的deployment还存在，因为默认是不会将out的osd自动删除的，这里的话是对应cluster.yaml中的一个选项</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210711161948.png" alt="image-20210711161948373"></p>
<p>​    这个默认是false，改为true就可以自动删除out的osd对应的deployment了</p>
<p>当然也可以手动使用ceph进行删除，但是最终osd对应的deployment需要你自己把它删除了</p>
</li>
</ol>
<h3 id="替换osd"><a href="#替换osd" class="headerlink" title="替换osd"></a>替换osd</h3><p>先删除osd，再加入osd</p>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/rook/%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/rook/%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">Rook简介</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-07 08:43:29 / 修改时间：11:58:13" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rook/" itemprop="url" rel="index"><span itemprop="name">Rook</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/rook/%E7%AE%80%E4%BB%8B/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/rook/%E7%AE%80%E4%BB%8B/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>50</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>可以在k8s之上部署存储集群</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ol>
<li><p>简单可靠</p>
</li>
<li><p>超融合解决方案</p>
</li>
<li><p>减少数据丢失</p>
</li>
<li><p>块、文件、对象存储</p>
</li>
</ol>
<h3 id="Rook架构"><a href="#Rook架构" class="headerlink" title="Rook架构"></a>Rook架构</h3><p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210707153959.png" alt="image-20210707153958257"></p>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/rook/dashboard/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/rook/dashboard/" class="post-title-link" itemprop="url">dashboard</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-07 08:43:29 / 修改时间：11:58:57" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rook/" itemprop="url" rel="index"><span itemprop="name">Rook</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/rook/dashboard/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/rook/dashboard/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>191</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li><p>使用ceph中的dashboard-external-https.yaml,<strong>注意不是dashboard-external-http.yaml</strong></p>
</li>
<li><p>apply一下</p>
</li>
<li><p>访问对应地址，注意要使用https</p>
</li>
<li><p>默认账户</p>
<p>username：admin</p>
<p>password在rook-ceph中的rook-ceph-dashboard-password（secrets）</p>
<p>密码也是经过bas464加密的，使用需要解密</p>
</li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/rook/cephfs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/rook/cephfs/" class="post-title-link" itemprop="url">cephfs</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-07 08:43:29 / 修改时间：11:58:54" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rook/" itemprop="url" rel="index"><span itemprop="name">Rook</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/rook/cephfs/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/rook/cephfs/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="CephFS"><a href="#CephFS" class="headerlink" title="CephFS"></a>CephFS</h3><p>cephfs架构图</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210710220532.png" alt="image-20210710220532238"></p>
<p>​        <strong>优点</strong></p>
<p>​            可以同时支持多个客户端进行访问</p>
<p>​            可以双主双从</p>
<h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><p>在/root/rook/rook/cluster/examples/kubernetes/ceph下有两个文件</p>
<ul>
<li>filesystem.yaml  （副本方式）</li>
<li>filesystem-ec.yaml （纠删码方式）</li>
</ul>
<p>部署完之后会创建两个pool</p>
<ul>
<li><p>myfs-metadata （存储元数据的pool）</p>
</li>
<li><p>myfs-data0  （存储数据的pool）</p>
</li>
</ul>
<h3 id="调整"><a href="#调整" class="headerlink" title="调整"></a>调整</h3><p>因为mds对于CPU的要求比较高，因此我们希望其落在CPU资源比较好的节点上</p>
<p>和前面的cluster.yaml调整一样，在filesystem.yaml中调整资源，设置label</p>
<img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210710222713.png" alt="image-20210710222713137" style="zoom:50%;" />

<p><strong>注意：有可能设置了只有所有的mds都被调度到同一个node上面</strong></p>
<p>即如下场景：</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210710222847.png" alt="image-20210710222847347"></p>
<p>这样的话高可用就无从谈起了</p>
<p>因此我们还需要设置反亲和力</p>
<img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210710222949.png" alt="image-20210710222948996" style="zoom:50%;" />

<p>还是原来的filesystem.yaml的上面进行调整，就是把注释的注释掉就可以了，最终apply一下就会是得mds分布在不同的node上面</p>
<h3 id="创建cephFS的storageclass"><a href="#创建cephFS的storageclass" class="headerlink" title="创建cephFS的storageclass"></a>创建cephFS的storageclass</h3><p>在/rook/cluster/examples/kubernetes/ceph/csi/cephfs下的storageclass.yaml文件    </p>
<p>可以看到创建成功</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210710223544.png" alt="image-20210710223544320"></p>
<h3 id="创建cephFS的PV和PVC"><a href="#创建cephFS的PV和PVC" class="headerlink" title="创建cephFS的PV和PVC"></a>创建cephFS的PV和PVC</h3><p>在/rook/cluster/examples/kubernetes/ceph/csi/cephfs下的kube-registry.yaml</p>
<p>注意这里创建之后的pvc是在kube-system namespace下，创建的deployment也是在kube-system namespace下</p>
<p><strong>最终是多个pod共用一个卷</strong></p>
<h3 id="cephFS挂载到外部环境"><a href="#cephFS挂载到外部环境" class="headerlink" title="cephFS挂载到外部环境"></a>cephFS挂载到外部环境</h3><p>mount -t ceph -o name=admin,secret=AQACT+lgnAhZCBAAni/JDL0LP+zq6CL+Wt4v3Q==,mds_namespace=myfs 10.98.81.9:6789,10.98.168.211:6789,10.108.58.246:6789:/ /media/</p>
<p>其中的name还有secret是在/etc/ceph/keyring文件中</p>
<p>mds_namespace是ceph -s中mds的名称，后面的地址为/etc/ceph/ceph.conf的ceph集群路径</p>
<p>挂载的路径是 /media/下</p>
<h3 id="故障排查"><a href="#故障排查" class="headerlink" title="故障排查"></a>故障排查</h3><ul>
<li>最基本查看ceph -s</li>
<li>容器<ul>
<li>mds的容器</li>
<li>对接时候的驱动日志<ul>
<li>csi-cephfsplugin-provisioner-xxxx</li>
<li>csi-cephfsplugin-xxx</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/JavaWeb/%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/07/JavaWeb/%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81/" class="post-title-link" itemprop="url">中文乱码</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-07 08:43:29" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-13 09:01:12" itemprop="dateModified" datetime="2021-02-13T09:01:12+08:00">2021-02-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/JavaWeb/%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/JavaWeb/%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>324</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h4><h5 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h5><p>​    该情况主要发生在发送post请求时参数带有中文，get请求再次情景下不会出现乱码</p>
<h5 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h5><p>​    在doPost方法中调用setCharacterEncoding（“UTF-8”）</p>
<p>​    该方法一定要写在最前面，否则不生效。</p>
<hr>
<h4 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h4><h5 id="场景-1"><a href="#场景-1" class="headerlink" title="场景"></a>场景</h5><p>​    response传递中文字符浏览器端出现乱码</p>
<h5 id="解决办法-1"><a href="#解决办法-1" class="headerlink" title="解决办法"></a>解决办法</h5><p><font color = red><strong>以下方法必须写在获取流之前</strong></font></p>
<p>方法一：</p>
<ol>
<li><p> 设置服务器端字符集</p>
</li>
<li><p>通过响应头设置浏览器端字符集</p>
<p> resp.setHeader(“Content-type”,”text/html;charset=UTF-8”)</p>
</li>
</ol>
<p>方法二：</p>
<p>​    resp.setContentType(“text/html;charset=UTF-8”)</p>
<p>​    这一行代码同时设置客户端和服务端都使用UTF-8</p>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/32/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><span class="page-number current">33</span><a class="page-number" href="/page/34/">34</a><a class="page-number" href="/page/35/">35</a><a class="extend next" rel="next" href="/page/34/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Cooper</p>
  <div class="site-description" itemprop="description">记录一些学习笔记、小说、随笔</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">341</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">75</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/CooperXJ" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CooperXJ" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1789023580@qq.com" title="E-Mail → mailto:1789023580@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cooper</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">648k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">9:49</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'rOzi1T6uncSYNdx0tp1owOzV-gzGzoHsz',
      appKey     : 'Fk3s6CQBK042e1QltClHnTBP',
      placeholder: "留下邮箱，有回复时你将收到提醒，邮箱不会被公开",
      avatar     : 'wavatar',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
