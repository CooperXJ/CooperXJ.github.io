<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"cooperxj.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="非模式简单动态字符串（SDS）结构 len （int） 记录当前已经使用字节的长度 free（int）记录当前buf数组中未使用字节的数量 buf[] (char) 字节数组，保存字符串（因为不仅仅保存的是字符串，有时候也会保存二进制数据，因此成为字节数组）  优点 可以在O(1)时间复杂度内统计字符串的长度  可以避免缓冲区的溢出，因为常见的C中的字符串函数比如strcat(char *dest">
<meta property="og:type" content="article">
<meta property="og:title" content="redis数据结构">
<meta property="og:url" content="http://cooperxj.github.io/2022/01/07/redis/redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/index.html">
<meta property="og:site_name" content="Cooper Notes">
<meta property="og:description" content="非模式简单动态字符串（SDS）结构 len （int） 记录当前已经使用字节的长度 free（int）记录当前buf数组中未使用字节的数量 buf[] (char) 字节数组，保存字符串（因为不仅仅保存的是字符串，有时候也会保存二进制数据，因此成为字节数组）  优点 可以在O(1)时间复杂度内统计字符串的长度  可以避免缓冲区的溢出，因为常见的C中的字符串函数比如strcat(char *dest">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210828100439.png">
<meta property="article:published_time" content="2022-01-07T00:43:29.196Z">
<meta property="article:modified_time" content="2022-01-07T04:01:38.251Z">
<meta property="article:author" content="Cooper">
<meta property="article:tag" content="redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210828100439.png">

<link rel="canonical" href="http://cooperxj.github.io/2022/01/07/redis/redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>redis数据结构 | Cooper Notes</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Cooper Notes</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">obey rules</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://cooperxj.github.io/2022/01/07/redis/redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cooper">
      <meta itemprop="description" content="记录一些学习笔记、小说、随笔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cooper Notes">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          redis数据结构
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-07 08:43:29 / 修改时间：12:01:38" itemprop="dateCreated datePublished" datetime="2022-01-07T08:43:29+08:00">2022-01-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/redis/" itemprop="url" rel="index"><span itemprop="name">redis</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/07/redis/redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/07/redis/redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="非模式"><a href="#非模式" class="headerlink" title="非模式"></a>非模式</h2><h3 id="简单动态字符串（SDS）"><a href="#简单动态字符串（SDS）" class="headerlink" title="简单动态字符串（SDS）"></a>简单动态字符串（SDS）</h3><h4 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h4><ul>
<li>len （int） 记录当前已经使用字节的长度</li>
<li>free（int）记录当前buf数组中未使用字节的数量</li>
<li>buf[] (char) 字节数组，保存字符串（<font color=red>因为不仅仅保存的是字符串，有时候也会保存二进制数据，因此成为字节数组</font>）</li>
</ul>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li><p>可以在O(1)时间复杂度内统计字符串的长度</p>
</li>
<li><p>可以避免缓冲区的溢出，因为常见的C中的字符串函数比如strcat(char *dest,char *src)需要用户保证dest有足够的空间，否则会缓冲区溢出。但是SDS会先检查空间是否满足，如果不满足会根据一定的策略进行扩充空间</p>
<ul>
<li><p>对应分配策略</p>
<p>如果每次拼接字符串的操作都分配空间的话会比较耗时，因此这里采用了两种优化策略</p>
<ul>
<li><p>空间预分配</p>
<ul>
<li><p>修改之后SDS的长度&lt;1MB</p>
<p>分配2*len(修改之后的SDS)+1 （+1是为了保存’\0’）</p>
</li>
<li><p>修改之后SDS的长度&gt;=1MB</p>
<p>除了分配满足修改之后的SDS的空间，会额外分配一个1MB的未使用空间+1（+1是为了保存’\0’）</p>
</li>
</ul>
</li>
<li><p>惰性空间释放</p>
<p>当SDS需要缩短字符串时，不会收回当前SDS所占的空间中不需要的空间，而是使用free属性将这些空闲的空间记录下来，下次再使用</p>
</li>
</ul>
<p><font color=red>SDS有自己的API，比如sdscat,这些都是针对sds本身的API来说的</font></p>
</li>
</ul>
</li>
<li><p>二进制安全</p>
<p>在C语言中字符串只能存放文本数据，因为二进制数据会被分割（例如出现’\0’就会认为是一句话的结束），但是SDS会原封不动的保留所存放的字符串，不会对特殊字符进行任何限制、过滤。</p>
<p>因为SDS不是通过’\0’判断字符串是否结束，而是通过len属性来判断</p>
</li>
<li><p>兼容了C语言字符串的函数，常见的例如strcat，strcasecmp都可以使用</p>
<p>strcat(c_string,sds-&gt;buf)</p>
<p>strcasecmp(c_string,sds-&gt;buf)</p>
</li>
</ul>
<h4 id="编码类型"><a href="#编码类型" class="headerlink" title="编码类型"></a>编码类型</h4><h5 id="种类"><a href="#种类" class="headerlink" title="种类"></a>种类</h5><ul>
<li><p>int</p>
<p>如果字符串对象保存的是整数数值，并且这个整数数值可以使用long类型来表示，那么该字符串对象的编码为int</p>
<p><strong>double类型会保存为字符串类型</strong></p>
</li>
<li><p>embstr</p>
<p>如果字符串对象保存的是一个字符串值，并且这个字符串值的长度&lt;=39字节，那么这个字符串对象将使用embstr编码方式保存这个字符串值</p>
</li>
<li><p>raw</p>
<p>如果字符串对象保存的是一个字符串值，并且这个字符串值的长度&gt;39字节，那么这个字符串对象将使用raw编码方式保存这个字符串值</p>
</li>
</ul>
<h5 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h5><ul>
<li><p>embstr通过调用一次内存分配函数来创建redisObject结构和sdshdr结构，但是raw会调用两次内存分配函数</p>
</li>
<li><p>释放embstr的字符串对象只需要调用一次内存释放函数，raw需要两次</p>
</li>
<li><p>embstr的字符串对象都保存在一块连续的内存中，可以更好利用缓存带来的优势</p>
</li>
</ul>
<h5 id="转换"><a href="#转换" class="headerlink" title="转换"></a>转换</h5><ul>
<li>int类型如果被执行命令之后变为了字符串，那么会成为raw类型</li>
<li><font color=red>embstr类型只有只读属性，如果被修改了会变成raw编码类型</font></li>
</ul>
<hr>
<h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><h4 id="编码类型-1"><a href="#编码类型-1" class="headerlink" title="编码类型"></a>编码类型</h4><h5 id="种类-1"><a href="#种类-1" class="headerlink" title="种类"></a>种类</h5><ul>
<li><p>ziplist</p>
<p>压缩链表</p>
</li>
<li><p>linkedlist</p>
<p>双向链表</p>
</li>
</ul>
<h5 id="转换-1"><a href="#转换-1" class="headerlink" title="转换"></a>转换</h5><p>当以下2个条件都满足时</p>
<ul>
<li><p>列表保存到所有字符串元素长度&lt;64字节</p>
</li>
<li><p>列表对象保存的元素数量&lt;512个</p>
</li>
</ul>
<p>会使用ziplist编码</p>
<p>否则会使用linkedlist编码</p>
<h5 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h5><p>在元素较少时，ziplist可以更好的节约内存，并且是以连续块方式保存的压缩列表比起双端链表可以更快地载入到缓存中</p>
<h4 id="linkedlist"><a href="#linkedlist" class="headerlink" title="linkedlist"></a>linkedlist</h4><h5 id="结构-1"><a href="#结构-1" class="headerlink" title="结构"></a>结构</h5><ul>
<li>Node<ul>
<li>listNode * prve</li>
<li>listNode * next</li>
<li>void * value</li>
</ul>
</li>
<li>list<ul>
<li>listNode *head</li>
<li>listNode *tail</li>
<li>long len</li>
<li>dup （节点复制函数）</li>
<li>free （节点释放值函数）</li>
<li>match （节点值比较函数）</li>
</ul>
</li>
</ul>
<h5 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h5><ul>
<li>双端无环，可以在O(1)时间内找到头结点和尾结点</li>
<li>自带计数器，可以在O(1)时间内找到长度</li>
<li>多台，使用void *指针存放节点值，可以保存不同类型的值</li>
</ul>
<h4 id="ziplist（压缩列表）"><a href="#ziplist（压缩列表）" class="headerlink" title="ziplist（压缩列表）"></a>ziplist（压缩列表）</h4><h5 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h5><ul>
<li>当一个列表键只包含少量列表项，并且每个列表项要么就是小整数值，要么就是长度比较短的字符串，那么redis就会使用压缩列表来做列表键的底层实现</li>
<li>当一个哈希键只包含少量键值对，并且每个键值对的键和值要么就是小整数值，要么就是长度比较短的字符串，那么redis就会使用压缩列表来做哈希键的底层实现</li>
</ul>
<h5 id="压缩节点"><a href="#压缩节点" class="headerlink" title="压缩节点"></a>压缩节点</h5><h6 id="结构-2"><a href="#结构-2" class="headerlink" title="结构"></a>结构</h6><ul>
<li><p>previous_entry_length</p>
<p>记录压缩列表中前一个节点的长度</p>
<p>以字节为单位</p>
<ul>
<li>如果前一个节点的长度&lt;254则使用一个字节表示</li>
<li>如果前一个节点的长度&gt;=254则使用5个字节表示</li>
</ul>
<p><strong>好处：可以通过该属性达到从后向前遍历的目的</strong></p>
<p><font color=red>注意点：插入或者删除节点，有可能引起连锁更新，也就是这个属性的长度会随着操作而发生变化，但是整体影响不大</font></p>
</li>
<li><p>encoding</p>
<p>记录节点的content属性所保存的类型以及长度</p>
<ul>
<li>一字节、两字节或者五字节长，值的最高位为00，01或者10的是字节数组编码，表示content属性保存着字节数组，数组的长度为编码除去最高两位之后的其他记录</li>
<li>一个字节长，值的最高位以11开头的是整数编码，表示content属性保存的是整数值，整数的类型和长度为编码除去最高两位之后的其他记录</li>
</ul>
</li>
<li><p>content</p>
<p>保存节点的值</p>
</li>
</ul>
<h5 id="压缩列表"><a href="#压缩列表" class="headerlink" title="压缩列表"></a>压缩列表</h5><h6 id="结构-3"><a href="#结构-3" class="headerlink" title="结构"></a>结构</h6><ul>
<li><p>zlbytes （unit32_t）</p>
<p>记录压缩列表占用的内存字节数</p>
</li>
<li><p>zltail （unit32_t）</p>
<p>记录压缩列表表尾节点距离压缩列表的起始地址有多少字节，通过该偏移量可以无需遍历整个压缩列表就可以确定表尾节点的地址</p>
</li>
<li><p>zllen （unit16_t）</p>
<p>记录压缩列表包含的节点数量</p>
</li>
<li><p>entryX</p>
<p>压缩列表节点</p>
</li>
<li><p>zlend</p>
<p>特殊值0xFF，用于标记压缩列表的末端</p>
</li>
</ul>
<h4 id="QuickList"><a href="#QuickList" class="headerlink" title="QuickList"></a>QuickList</h4><h5 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h5><p>quicklist结构是在redis 3.2版本中新加的数据结构，用在<strong>列表的底层实现。</strong></p>
<h5 id="结构-4"><a href="#结构-4" class="headerlink" title="结构"></a>结构</h5><p>quicklist是由<strong>ziplist组成的双向链表</strong>，链表中的每一个节点都以压缩列表ziplist的结构保存着数据，而ziplist有多个entry节点，保存着数据。相当与一个quicklist节点保存的是<strong>一片数据，而不再是一个数据</strong>。</p>
<h5 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h5><ul>
<li>quicklist宏观上是一个双向链表，因此，它具有一个双向链表的有点，进行插入或删除操作时非常方便，虽然复杂度为O(n)，但是不需要内存的复制，提高了效率，而且访问两端元素复杂度为O(1)。</li>
<li>quicklist微观上是一片片entry节点，每一片entry节点内存连续且顺序存储，可以通过二分查找以 log2(n) 的复杂度进行定位。</li>
</ul>
<hr>
<h3 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h3><h4 id="哈希表节点-dictEntry"><a href="#哈希表节点-dictEntry" class="headerlink" title="哈希表节点 (dictEntry)"></a>哈希表节点 (dictEntry)</h4><h5 id="结构-5"><a href="#结构-5" class="headerlink" title="结构"></a>结构</h5><ul>
<li><p>key (void*)</p>
</li>
<li><p>v (union{void *val,unit64_t u64,int64_t s64})</p>
<p>v可以是一个指针，unit64_t 整数或者int64_t整数</p>
</li>
<li><p>next （指向下一个节点）</p>
<p>主要是解决键冲突问题，当有冲突的时候直接将新的节点添加在表头处，也就是头插法</p>
</li>
</ul>
<h4 id="哈希表-dictht"><a href="#哈希表-dictht" class="headerlink" title="哈希表 (dictht)"></a>哈希表 (dictht)</h4><h5 id="结构-6"><a href="#结构-6" class="headerlink" title="结构"></a>结构</h5><ul>
<li><p>table （dictEntry**）</p>
<p>哈希表数组，每个元素就是一个哈希表节点</p>
</li>
<li><p>size （unsigned long）</p>
<p>哈希表的大小</p>
</li>
<li><p>sizemask （unsigned long）</p>
<p>哈希表大小掩码 = size-1</p>
</li>
<li><p>used （unsigned long）</p>
<p>哈希表中已有节点的数量</p>
</li>
</ul>
<h4 id="字典-dict"><a href="#字典-dict" class="headerlink" title="字典 (dict)"></a>字典 (dict)</h4><h5 id="结构-7"><a href="#结构-7" class="headerlink" title="结构"></a>结构</h5><ul>
<li><p>type （dictType*）</p>
<p>指向dictType的指针，每个dictType结构包含了一组操作特定类型键值对的函数</p>
<p>比如hashFunction 计算哈希值的函数</p>
</li>
<li><p>privdata （void*）</p>
<p>保存需要传给类型特定函数的可选参数（就是dictType中的函数）</p>
</li>
<li><p>ht[2] (dicth)</p>
<p>哈希表数组</p>
<ul>
<li><p>ht[0]</p>
<p>字典使用的哈希表</p>
</li>
<li><p>ht[1]</p>
<p>留给rehash使用的 </p>
</li>
</ul>
</li>
<li><p>trehashidx</p>
<p>rehash索引，当rehash不进行时是-1</p>
</li>
</ul>
<h4 id="hash算法"><a href="#hash算法" class="headerlink" title="hash算法"></a>hash算法</h4><p>hash = dict-&gt;type-&gt;hashFunction(k0)</p>
<p>index = hash &amp; ht[0].sizemask</p>
<p>使用的算法是MurmurHash2，该算法的优点在于即使输入的键是有规律的，算法仍能给出一个很好的随机分布性</p>
<h4 id="rehash"><a href="#rehash" class="headerlink" title="rehash"></a>rehash</h4><h5 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h5><ul>
<li><p>为字典的ht[1]分配空间，空间的大小取决于需要执行的操作</p>
<ul>
<li><p>扩展操作</p>
<ul>
<li><p>场景</p>
<p>负载因子 = 哈希表已保存的节点数量/哈希表的大小 = used/size</p>
<p>当服务器目前没有执行BGSAVE或者BGREWRITEAOF，并且哈希表的负载因子&gt;=1</p>
<p>or</p>
<p>当服务器正在执行BGSAVE或者BGREWRITEAOF，并且哈希表的负载因子&gt;=5</p>
</li>
<li><p>操作</p>
<p>ht[1]的大小为<strong>第一个</strong>&gt;=ht[0].used*2<sup>n</sup></p>
</li>
</ul>
</li>
<li><p>收缩操作</p>
<ul>
<li><p>场景</p>
<p>哈希表的负载因子&lt;0.1</p>
</li>
<li><p>操作</p>
<p>ht[1]的大小为<strong>第一个</strong>&gt;=ht[0].used的2<sup>n</sup></p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>将保存在ht[0]中的所有键值对rehash到ht[1]上面</p>
</li>
<li><p>当所有的ht[0]包含的所有键值对都迁移到了ht[1]之后，释放ht[0],将ht[1]设置为ht[0]，并在ht[1]新创建一个空白哈希表</p>
</li>
</ul>
<h5 id="渐进式rehash"><a href="#渐进式rehash" class="headerlink" title="渐进式rehash"></a>渐进式rehash</h5><p>每次对字典执行操作的时候，除了执行指定的操作还会将ht[0]上面的键值rehash到ht[1]，每次rehash后都会将rehashidx+1，当所有的rehash都已经完成了，则将rehashidx置为-1，表示rehash操作已完成</p>
<p>对于rehash期间的查找：</p>
<p>如果在ht[0]中没有找到，那么会去ht[1]中进行查找</p>
<h4 id="编码种类"><a href="#编码种类" class="headerlink" title="编码种类"></a>编码种类</h4><h5 id="种类-2"><a href="#种类-2" class="headerlink" title="种类"></a>种类</h5><ul>
<li><p>ziplist</p>
<p>它会将同一键值对的两个节点都放在一起</p>
</li>
<li><p>hashtable</p>
</li>
</ul>
<h5 id="转换-2"><a href="#转换-2" class="headerlink" title="转换"></a>转换</h5><p>当以下2个条件都满足时</p>
<ul>
<li><p>哈希对象保存的所有键值的键和值的字符串长度&lt;64字节</p>
</li>
<li><p>哈希对象保存的键值对数量&lt;512</p>
</li>
</ul>
<p>会使用ziplist编码</p>
<p>否则会使用hashtable编码</p>
<hr>
<h3 id="跳跃表"><a href="#跳跃表" class="headerlink" title="跳跃表"></a>跳跃表</h3><h4 id="跳跃表节点"><a href="#跳跃表节点" class="headerlink" title="跳跃表节点"></a>跳跃表节点</h4><h5 id="结构-8"><a href="#结构-8" class="headerlink" title="结构"></a>结构</h5><ul>
<li><p>backward （struct zskiplistNode）</p>
<p>后退指针</p>
</li>
<li><p>score （doule）</p>
<p>分值</p>
</li>
<li><p>obj （robj *）</p>
<p>成员对象，一般主要是SDS</p>
</li>
<li><p>level[]  (struct zskiplistLevel)</p>
<p> 层</p>
<ul>
<li>forward （struct zskiplistNode） 前进指针</li>
<li>span （unsigned int）跨度</li>
</ul>
</li>
</ul>
<p>结构如图所示：</p>
<p><img src="https://raw.githubusercontent.com/CooperXJ/ImageBed/master/img/20210828100439.png" alt="在这里插入图片描述"></p>
<h5 id="对于每个节点上层的大小"><a href="#对于每个节点上层的大小" class="headerlink" title="对于每个节点上层的大小"></a>对于每个节点上层的大小</h5><p>随机生成一个介于1和32之间的值作为level数组的大小</p>
<h5 id="如何知道已经到达表的尾端"><a href="#如何知道已经到达表的尾端" class="headerlink" title="如何知道已经到达表的尾端"></a>如何知道已经到达表的尾端</h5><p>再最后一个节点中所有的层中的forward都指向null</p>
<h5 id="头节点"><a href="#头节点" class="headerlink" title="头节点"></a>头节点</h5><p>一般一共有32个level</p>
<h4 id="跳跃表-1"><a href="#跳跃表-1" class="headerlink" title="跳跃表"></a>跳跃表</h4><h5 id="结构-9"><a href="#结构-9" class="headerlink" title="结构"></a>结构</h5><p>跳跃表</p>
<ul>
<li><p>header</p>
<p>指向第一个节点</p>
</li>
<li><p>tail</p>
<p>指向最后一个尾节点</p>
</li>
<li><p>level</p>
<p>目前跳跃表内，层数最大的那个节点的层数（不包括头节点）</p>
</li>
<li><p>length</p>
<p>跳跃表的长度</p>
</li>
</ul>
<h5 id="跳跃表的时间复杂度"><a href="#跳跃表的时间复杂度" class="headerlink" title="跳跃表的时间复杂度"></a>跳跃表的时间复杂度</h5><p>O(logN) ~ O(N)</p>
<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><h4 id="编码类型-2"><a href="#编码类型-2" class="headerlink" title="编码类型"></a>编码类型</h4><h5 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h5><ul>
<li><p>intset</p>
</li>
<li><p>hashtable</p>
<p>字典的每个键都是一个字符串对象，每个字符串对象为一个集合元素，字典的值都为null</p>
</li>
</ul>
<h5 id="转换-3"><a href="#转换-3" class="headerlink" title="转换"></a>转换</h5><p>当以下2个条件都满足时</p>
<ul>
<li><p>集合对象保存的所有元素为整数值</p>
</li>
<li><p>集合对象保存的元素数量&lt;512个</p>
</li>
</ul>
<p>会使用inset编码</p>
<p>否则会使用hashtable编码</p>
<h4 id="整数集合"><a href="#整数集合" class="headerlink" title="整数集合"></a>整数集合</h4><h5 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h5><p>有序的整数集合</p>
<h5 id="结构-10"><a href="#结构-10" class="headerlink" title="结构"></a>结构</h5><ul>
<li><p>encoding (uint32_t) 编码方式</p>
<p><font color=red>该值代表了整个集合中元素的类型</font></p>
</li>
<li><p>length (uint32_t) 元素数量</p>
</li>
<li><p>contents[] (int8_t)</p>
<p>保存元素的数组，此处的int8_t并非代表的是元素的类型，真正的类型取决于encoding</p>
</li>
</ul>
<h5 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h5><ul>
<li><p>含义</p>
<p>当元素的类型都为int8时，突然增加一个int16的元素，那么整个数组中的元素都将升级为int16类型</p>
</li>
<li><p>步骤</p>
<ol>
<li><p>根据新元素的类型，扩展整数集合底层数组的空间大小</p>
</li>
<li><p>将底层数组现有的所有元素都转换成与新元素相同的类型，并将转换后的元素放置到正确位上，在放置元素过程中需要保持底层数组的有序性质不变</p>
</li>
<li><p>将新元素添加到底层数组中</p>
<p>对于新元素的摆放位置，因为发生了升级，要么是比现有的元素都大，要么是比现有的元素都小，插入的时间复杂度为O(1)</p>
</li>
</ol>
</li>
<li><p>当元素进行升级之后就不能再降级</p>
</li>
<li><p>升级的好处在于节约内存</p>
</li>
</ul>
<h5 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h5><ul>
<li><p>创建整数集合</p>
<p><code>sadd &#123;集合名词&#125; &#123;元素...&#125;</code></p>
</li>
<li><p>查看集合类型</p>
<p><code>object encoding &#123;key&#125;</code></p>
</li>
</ul>
<hr>
<h3 id="有序集合对象"><a href="#有序集合对象" class="headerlink" title="有序集合对象"></a>有序集合对象</h3><h4 id="编码类型-3"><a href="#编码类型-3" class="headerlink" title="编码类型"></a>编码类型</h4><h5 id="类型-1"><a href="#类型-1" class="headerlink" title="类型"></a>类型</h5><ul>
<li><p>ziplist</p>
</li>
<li><p>skiplist</p>
<p>skiplist使用zset结构作为底层实现</p>
</li>
</ul>
<h5 id="转换-4"><a href="#转换-4" class="headerlink" title="转换"></a>转换</h5><p>当以下2个条件都满足时</p>
<ul>
<li><p>有序集合保存到所有字符串元素长度&lt;64字节</p>
</li>
<li><p>有序集合对象保存的元素数量&lt;128个</p>
</li>
</ul>
<p>会使用ziplist编码</p>
<p>否则会使用skiplist编码</p>
<h4 id="zst"><a href="#zst" class="headerlink" title="zst"></a>zst</h4><h5 id="结构-11"><a href="#结构-11" class="headerlink" title="结构"></a>结构</h5><ul>
<li><p>zskiplist</p>
<p>跳跃表</p>
</li>
<li><p>dict</p>
<p>字典</p>
</li>
</ul>
<h5 id="为何要同时使用skiplist和dict"><a href="#为何要同时使用skiplist和dict" class="headerlink" title="为何要同时使用skiplist和dict"></a>为何要同时使用skiplist和dict</h5><ul>
<li><p>skiplist</p>
<p>较好的执行范围型的操作，比如zrank、zrange</p>
</li>
<li><p>dict</p>
<p>对于查找操作，可以将复杂度将为O（1）</p>
</li>
</ul>
<hr>
<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><h4 id="定义-3"><a href="#定义-3" class="headerlink" title="定义"></a>定义</h4><p>redis中每一个对象都是由一个redisObject结构表示</p>
<h4 id="结构-12"><a href="#结构-12" class="headerlink" title="结构"></a>结构</h4><ul>
<li><p>type (unsigned)</p>
<p>类型</p>
<p>主要包括一下几种类型：</p>
<ul>
<li>字符串对象</li>
<li>列表对象</li>
<li>哈希对象</li>
<li>集合对象</li>
<li>有序集合对象</li>
</ul>
</li>
<li><p>encoding （unsigned）</p>
<p>编码类型</p>
<ul>
<li><p>定义</p>
<p>记录了对象所使用的编码。也就是这对象使用了什么数据结构作为底层的实现</p>
<p>每种类型的对象都至少使用了2种不同的编码</p>
</li>
</ul>
</li>
<li><p>ptr （void*）</p>
<p>指向底层实现数据结构的指针</p>
</li>
<li><p>…</p>
</li>
</ul>
<h4 id="类型检查与命令多态"><a href="#类型检查与命令多态" class="headerlink" title="类型检查与命令多态"></a>类型检查与命令多态</h4><h5 id="类型检查"><a href="#类型检查" class="headerlink" title="类型检查"></a>类型检查</h5><ul>
<li>redis会对输入的命令执行类型检查操作，也就是专有的命令必须对应指定的类型</li>
</ul>
<h5 id="命令多态"><a href="#命令多态" class="headerlink" title="命令多态"></a>命令多态</h5><ul>
<li><p>类型多态</p>
<p>像del、expire、type这种可以针对任何类型使用</p>
</li>
<li><p>编码多态</p>
<p>像llen这种命令是针对指定类型的，但是这个类型下面的不同编码都可以使用该指令</p>
</li>
</ul>
<h4 id="内存回收"><a href="#内存回收" class="headerlink" title="内存回收"></a>内存回收</h4><p>redis内部会构建一个计数器实现内存的回收</p>
<p>每个对象的引用计数信息由redisObject结构的refcount属性记录</p>
<ul>
<li>新建对象 +1</li>
<li>该对象被新程序使用 +1</li>
<li>不被一个程序使用 -1</li>
<li>=0时释放该对象占用的内存</li>
</ul>
<h4 id="对象共享"><a href="#对象共享" class="headerlink" title="对象共享"></a>对象共享</h4><p>一般redis中只对包含整数值的字符串对象进行共享</p>
<p>对于字符串对象不会共享，因为需要检查字符串是否相等，这会极大的消耗CPU</p>
<h4 id="对象的空转时长"><a href="#对象的空转时长" class="headerlink" title="对象的空转时长"></a>对象的空转时长</h4><p>redisObject中包含一个lru属性，表示该对象最后一次被命令程序访问的时间</p>
<p>命令</p>
<p><code>object idletime &#123;key&#125;</code></p>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\01\07\redis\AOF持久化\" rel="bookmark">AOF持久化</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\01\07\redis\RDB持久化\" rel="bookmark">RBD持久化</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\01\07\redis\redis客户端\" rel="bookmark">redis客户端</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\01\07\redis\Sentinel\" rel="bookmark">哨兵</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\01\07\redis\redis数据库\" rel="bookmark">redis数据库</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Cooper 微信支付">
        <p>微信支付</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Cooper
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://cooperxj.github.io/2022/01/07/redis/redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="redis数据结构">http://cooperxj.github.io/2022/01/07/redis/redis数据结构/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/redis/" rel="tag"># redis</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/01/07/redis/Sentinel/" rel="prev" title="哨兵">
      <i class="fa fa-chevron-left"></i> 哨兵
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/01/07/redis/%E5%A4%8D%E5%88%B6/" rel="next" title="复制">
      复制 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%9E%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.</span> <span class="nav-text">非模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E5%8A%A8%E6%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%88SDS%EF%BC%89"><span class="nav-number">1.1.</span> <span class="nav-text">简单动态字符串（SDS）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%84"><span class="nav-number">1.1.1.</span> <span class="nav-text">结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9"><span class="nav-number">1.1.2.</span> <span class="nav-text">优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.1.3.</span> <span class="nav-text">编码类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A7%8D%E7%B1%BB"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">种类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AF%94%E8%BE%83"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">比较</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">转换</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%97%E8%A1%A8"><span class="nav-number">1.2.</span> <span class="nav-text">列表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B-1"><span class="nav-number">1.2.1.</span> <span class="nav-text">编码类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A7%8D%E7%B1%BB-1"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">种类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2-1"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">转换</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%96%E7%A0%81"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">编码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#linkedlist"><span class="nav-number">1.2.2.</span> <span class="nav-text">linkedlist</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-1"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-1"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">优点</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ziplist%EF%BC%88%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8%EF%BC%89"><span class="nav-number">1.2.3.</span> <span class="nav-text">ziplist（压缩列表）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8E%8B%E7%BC%A9%E8%8A%82%E7%82%B9"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">压缩节点</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-2"><span class="nav-number">1.2.3.2.1.</span> <span class="nav-text">结构</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">压缩列表</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-3"><span class="nav-number">1.2.3.3.1.</span> <span class="nav-text">结构</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#QuickList"><span class="nav-number">1.2.4.</span> <span class="nav-text">QuickList</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-1"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-4"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%89%B9%E7%82%B9"><span class="nav-number">1.2.4.3.</span> <span class="nav-text">特点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E5%85%B8"><span class="nav-number">1.3.</span> <span class="nav-text">字典</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8%E8%8A%82%E7%82%B9-dictEntry"><span class="nav-number">1.3.1.</span> <span class="nav-text">哈希表节点 (dictEntry)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-5"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">结构</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8-dictht"><span class="nav-number">1.3.2.</span> <span class="nav-text">哈希表 (dictht)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-6"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">结构</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%97%E5%85%B8-dict"><span class="nav-number">1.3.3.</span> <span class="nav-text">字典 (dict)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-7"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">结构</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hash%E7%AE%97%E6%B3%95"><span class="nav-number">1.3.4.</span> <span class="nav-text">hash算法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rehash"><span class="nav-number">1.3.5.</span> <span class="nav-text">rehash</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4"><span class="nav-number">1.3.5.1.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B8%90%E8%BF%9B%E5%BC%8Frehash"><span class="nav-number">1.3.5.2.</span> <span class="nav-text">渐进式rehash</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E7%A7%8D%E7%B1%BB"><span class="nav-number">1.3.6.</span> <span class="nav-text">编码种类</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A7%8D%E7%B1%BB-2"><span class="nav-number">1.3.6.1.</span> <span class="nav-text">种类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2-2"><span class="nav-number">1.3.6.2.</span> <span class="nav-text">转换</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%B3%E8%B7%83%E8%A1%A8"><span class="nav-number">1.4.</span> <span class="nav-text">跳跃表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%B3%E8%B7%83%E8%A1%A8%E8%8A%82%E7%82%B9"><span class="nav-number">1.4.1.</span> <span class="nav-text">跳跃表节点</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-8"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%B9%E4%BA%8E%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E4%B8%8A%E5%B1%82%E7%9A%84%E5%A4%A7%E5%B0%8F"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">对于每个节点上层的大小</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E7%9F%A5%E9%81%93%E5%B7%B2%E7%BB%8F%E5%88%B0%E8%BE%BE%E8%A1%A8%E7%9A%84%E5%B0%BE%E7%AB%AF"><span class="nav-number">1.4.1.3.</span> <span class="nav-text">如何知道已经到达表的尾端</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%B4%E8%8A%82%E7%82%B9"><span class="nav-number">1.4.1.4.</span> <span class="nav-text">头节点</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%B3%E8%B7%83%E8%A1%A8-1"><span class="nav-number">1.4.2.</span> <span class="nav-text">跳跃表</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-9"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%B3%E8%B7%83%E8%A1%A8%E7%9A%84%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">跳跃表的时间复杂度</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E5%90%88"><span class="nav-number">1.5.</span> <span class="nav-text">集合</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B-2"><span class="nav-number">1.5.1.</span> <span class="nav-text">编码类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2-3"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">转换</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B4%E6%95%B0%E9%9B%86%E5%90%88"><span class="nav-number">1.5.2.</span> <span class="nav-text">整数集合</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-2"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-10"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8D%87%E7%BA%A7"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">升级</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4"><span class="nav-number">1.5.2.4.</span> <span class="nav-text">指令</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.6.</span> <span class="nav-text">有序集合对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B-3"><span class="nav-number">1.6.1.</span> <span class="nav-text">编码类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B-1"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2-4"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">转换</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#zst"><span class="nav-number">1.6.2.</span> <span class="nav-text">zst</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-11"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%BA%E4%BD%95%E8%A6%81%E5%90%8C%E6%97%B6%E4%BD%BF%E7%94%A8skiplist%E5%92%8Cdict"><span class="nav-number">1.6.2.2.</span> <span class="nav-text">为何要同时使用skiplist和dict</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.7.</span> <span class="nav-text">对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-3"><span class="nav-number">1.7.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-12"><span class="nav-number">1.7.2.</span> <span class="nav-text">结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5%E4%B8%8E%E5%91%BD%E4%BB%A4%E5%A4%9A%E6%80%81"><span class="nav-number">1.7.3.</span> <span class="nav-text">类型检查与命令多态</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5"><span class="nav-number">1.7.3.1.</span> <span class="nav-text">类型检查</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E5%A4%9A%E6%80%81"><span class="nav-number">1.7.3.2.</span> <span class="nav-text">命令多态</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E5%9B%9E%E6%94%B6"><span class="nav-number">1.7.4.</span> <span class="nav-text">内存回收</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E5%85%B1%E4%BA%AB"><span class="nav-number">1.7.5.</span> <span class="nav-text">对象共享</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%A9%BA%E8%BD%AC%E6%97%B6%E9%95%BF"><span class="nav-number">1.7.6.</span> <span class="nav-text">对象的空转时长</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Cooper</p>
  <div class="site-description" itemprop="description">记录一些学习笔记、小说、随笔</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">341</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">75</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/CooperXJ" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CooperXJ" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1789023580@qq.com" title="E-Mail → mailto:1789023580@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cooper</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">648k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">9:49</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'rOzi1T6uncSYNdx0tp1owOzV-gzGzoHsz',
      appKey     : 'Fk3s6CQBK042e1QltClHnTBP',
      placeholder: "留下邮箱，有回复时你将收到提醒，邮箱不会被公开",
      avatar     : 'wavatar',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
